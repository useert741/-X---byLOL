local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local Color3 = Color3
local UDim2 = UDim2
local Instance = Instance
local task = task
local Enum = Enum

-- æ³¨å…¥å™¨æ–‡ä»¶æ“ä½œå…¼å®¹
local readFunc, writeFunc, getPathFunc, isSupported

-- æ£€æµ‹å¹¶é€‚é…ä¸åŒæ³¨å…¥å™¨
if type(syn) == "table" then
    readFunc = syn and (syn.readfile or readfile)
    writeFunc = syn and (syn.writefile or writefile)
    getPathFunc = function() 
        return (syn and syn.datapath and syn.datapath()) or "Synapse/Workspace"
    end
    isSupported = true
    print("âœ… é€‚é… Synapse X æ³¨å…¥å™¨")
elseif type(fluxus) == "table" then
    readFunc = readfile
    writeFunc = writefile
    getPathFunc = function() return "Fluxus/Scripts" end
    isSupported = true
    print("âœ… é€‚é… Fluxus æ³¨å…¥å™¨")
elseif type(KRNL_SAFE_CALL) == "function" or getexecutorname and string.find(string.lower(getexecutorname()), "krnl") then
    readFunc = readfile
    writeFunc = writefile
    getPathFunc = function() return "Krnl/Scripts" end
    isSupported = true
    print("âœ… é€‚é… KRNL æ³¨å…¥å™¨")
elseif type(identifyexecutor) == "function" then
    readFunc = readfile
    writeFunc = writefile
    getPathFunc = function() return "ScriptWare/Scripts" end
    isSupported = true
    print("âœ… é€‚é… Script-Ware æˆ–å…¶ä»–å…¼å®¹æ³¨å…¥å™¨")
else
    isSupported = false
    warn("âš ï¸ æœªçŸ¥æ³¨å…¥å™¨ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™")
    readFunc = function(path) return nil end
    writeFunc = function(path, content) return false end
    getPathFunc = function() return "Unknown/Scripts" end
end

-- Krnlé£æ ¼é…è‰²æ–¹æ¡ˆ
local KRNL_COLORS = {
    BACKGROUND = Color3.fromRGB(25, 25, 35),        -- æ·±ç°è“èƒŒæ™¯
    PRIMARY = Color3.fromRGB(125, 75, 200),         -- ä¸»ç´«è‰²
    SECONDARY = Color3.fromRGB(90, 60, 150),        -- æ·±ç´«è‰²
    ACCENT = Color3.fromRGB(150, 100, 220),         -- äº®ç´«è‰²
    TEXT = Color3.fromRGB(240, 240, 245),           -- æµ…ç°è‰²æ–‡å­—
    TEXT_SECONDARY = Color3.fromRGB(180, 180, 190), -- ä¸­ç°è‰²æ–‡å­—
    INPUT_BG = Color3.fromRGB(35, 35, 45),          -- è¾“å…¥æ¡†èƒŒæ™¯
    SUCCESS = Color3.fromRGB(100, 200, 100),        -- æˆåŠŸç»¿è‰²
    ERROR = Color3.fromRGB(220, 100, 100)           -- é”™è¯¯çº¢è‰²
}

-- å¯†é’¥ç³»ç»Ÿé…ç½®
local KEY_SYSTEM = {
    ENABLED = true,
    CORRECT_KEYS = {"LOL"},  -- è®¾ç½®å¯†é’¥ä¸ºLOL
    MAX_ATTEMPTS = 3,
    REMEMBER_DAYS = 30,
    DATA_FILE = "lolhub_key_data.json"
}

-- ç¡¬ä»¶IDç”Ÿæˆ
local function generateHardwareID()
    local success, result = pcall(function()
        if isSupported then
            local identifiers = {}
            table.insert(identifiers, tostring(game.Players.LocalPlayer.UserId))
            
            if type(syn) == "table" and syn.crypt then
                local hardwareId = syn.crypt.hash("md5", tostring(tick()) .. "synapse")
                table.insert(identifiers, string.sub(hardwareId, 1, 8))
            end
            
            local randomComponent = HttpService:GenerateGUID(false)
            table.insert(identifiers, string.sub(randomComponent, 1, 8))
            
            return table.concat(identifiers, "_")
        else
            return tostring(game.Players.LocalPlayer.UserId) .. "_" .. tostring(tick())
        end
    end)
    
    return success and result or "fallback_id_" .. tostring(tick())
end

-- æ–‡ä»¶æ“ä½œå‡½æ•°
local function safeReadFile(filePath)
    if not isSupported then return nil end
    
    local success, result = pcall(function()
        return readFunc(filePath)
    end)
    
    return success and result or nil
end

local function safeWriteFile(filePath, content)
    if not isSupported then return false end
    
    local success, result = pcall(function()
        writeFunc(filePath, content)
        return true
    end)
    
    return success or false
end

-- è·å–æ•°æ®å­˜å‚¨è·¯å¾„
local function getDataPath()
    local basePath = getPathFunc()
    if type(basePath) == "function" then
        basePath = basePath()
    end
    return basePath .. "/" .. KEY_SYSTEM.DATA_FILE
end

-- è®°å¿†ç”¨æˆ·ç³»ç»Ÿ
local function isUserRemembered()
    if not isSupported then return false end
    
    local dataPath = getDataPath()
    local savedData = safeReadFile(dataPath)
    
    if savedData then
        local success, data = pcall(function()
            return HttpService:JSONDecode(savedData)
        end)
        
        if success and data then
            local hardwareID = generateHardwareID()
            if data.hardwareID == hardwareID and data.expireTime and data.expireTime > os.time() then
                return true
            end
        end
    end
    
    return false
end

local function rememberUser()
    if not isSupported then return false end
    
    local dataPath = getDataPath()
    local hardwareID = generateHardwareID()
    local expireTime = os.time() + (KEY_SYSTEM.REMEMBER_DAYS * 24 * 60 * 60)
    
    local data = {
        hardwareID = hardwareID,
        expireTime = expireTime,
        rememberedAt = os.time()
    }
    
    local success = safeWriteFile(dataPath, HttpService:JSONEncode(data))
    return success
end

-- åˆ›å»ºæ¸æ˜¾ç´«è‰²è¾¹æ¡†æ•ˆæœ
local function createGlowingBorder(parentFrame)
    -- å¤–å‘å…‰è¾¹æ¡†
    local OuterGlow = Instance.new("Frame")
    OuterGlow.Size = UDim2.new(1, 10, 1, 10)
    OuterGlow.Position = UDim2.new(0, -5, 0, -5)
    OuterGlow.BackgroundColor3 = KRNL_COLORS.PRIMARY
    OuterGlow.BackgroundTransparency = 0.7
    OuterGlow.BorderSizePixel = 0
    OuterGlow.ZIndex = 0
    OuterGlow.Parent = parentFrame
    
    local OuterCorner = Instance.new("UICorner")
    OuterCorner.CornerRadius = UDim.new(0, 14)
    OuterCorner.Parent = OuterGlow
    
    -- ä¸­å‘å…‰è¾¹æ¡†
    local MiddleGlow = Instance.new("Frame")
    MiddleGlow.Size = UDim2.new(1, 6, 1, 6)
    MiddleGlow.Position = UDim2.new(0, -3, 0, -3)
    MiddleGlow.BackgroundColor3 = KRNL_COLORS.ACCENT
    MiddleGlow.BackgroundTransparency = 0.5
    MiddleGlow.BorderSizePixel = 0
    MiddleGlow.ZIndex = 0
    MiddleGlow.Parent = parentFrame
    
    local MiddleCorner = Instance.new("UICorner")
    MiddleCorner.CornerRadius = UDim.new(0, 12)
    MiddleCorner.Parent = MiddleGlow
    
    -- å†…å‘å…‰è¾¹æ¡†
    local InnerGlow = Instance.new("Frame")
    InnerGlow.Size = UDim2.new(1, 2, 1, 2)
    InnerGlow.Position = UDim2.new(0, -1, 0, -1)
    InnerGlow.BackgroundColor3 = KRNL_COLORS.SECONDARY
    InnerGlow.BackgroundTransparency = 0.3
    InnerGlow.BorderSizePixel = 0
    InnerGlow.ZIndex = 0
    InnerGlow.Parent = parentFrame
    
    local InnerCorner = Instance.new("UICorner")
    InnerCorner.CornerRadius = UDim.new(0, 11)
    InnerCorner.Parent = InnerGlow
    
    -- åˆ›å»ºè„‰åŠ¨åŠ¨ç”»
    local function createPulseAnimation(frame, delayTime)
        local pulseTween = TweenService:Create(
            frame,
            TweenInfo.new(
                2, -- æ—¶é—´
                Enum.EasingStyle.Sine, -- ç¼“åŠ¨æ ·å¼
                Enum.EasingDirection.InOut, -- ç¼“åŠ¨æ–¹å‘
                -1, -- é‡å¤æ¬¡æ•°ï¼ˆ-1ä¸ºæ— é™ï¼‰
                true, -- åè½¬
                delayTime -- å»¶è¿Ÿ
            ),
            {BackgroundTransparency = frame.BackgroundTransparency + 0.3}
        )
        pulseTween:Play()
    end
    
    -- ä¸ºæ¯ä¸ªè¾¹æ¡†å±‚æ·»åŠ è„‰åŠ¨åŠ¨ç”»
    createPulseAnimation(OuterGlow, 0)
    createPulseAnimation(MiddleGlow, 0.3)
    createPulseAnimation(InnerGlow, 0.6)
    
    return {OuterGlow, MiddleGlow, InnerGlow}
end

-- åˆ›å»ºKrnlé£æ ¼çš„ä¸­æ–‡å¯†é’¥éªŒè¯GUI
local function createKeyVerificationGUI()
    if PlayerGui:FindFirstChild("KeyVerification") then
        PlayerGui.KeyVerification:Destroy()
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "KeyVerification"
    ScreenGui.Parent = PlayerGui
    ScreenGui.ResetOnSpawn = false

    -- ä¸»æ¡†æ¶
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 420, 0, 350)
    MainFrame.Position = UDim2.new(0.5, -210, 0.5, -175)
    MainFrame.BackgroundColor3 = KRNL_COLORS.BACKGROUND
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Parent = ScreenGui

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 10)
    UICorner.Parent = MainFrame

    -- æ·»åŠ æ¸æ˜¾ç´«è‰²è¾¹æ¡†
    createGlowingBorder(MainFrame)

    -- é¡¶éƒ¨æ ‡é¢˜æ 
    local TopBar = Instance.new("Frame")
    TopBar.Size = UDim2.new(1, 0, 0, 40)
    TopBar.Position = UDim2.new(0, 0, 0, 0)
    TopBar.BackgroundColor3 = KRNL_COLORS.PRIMARY
    TopBar.BorderSizePixel = 0
    TopBar.ZIndex = 2
    TopBar.Parent = MainFrame

    local TopBarCorner = Instance.new("UICorner")
    TopBarCorner.CornerRadius = UDim.new(0, 10, 0, 0)
    TopBarCorner.Parent = TopBar

    -- æ ‡é¢˜
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -40, 1, 0)
    Title.Position = UDim2.new(0, 20, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "ğŸ” æ¬¢è¿ä½¿ç”¨ LOL HUB"
    Title.TextColor3 = KRNL_COLORS.TEXT
    Title.TextSize = 20
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.ZIndex = 2
    Title.Parent = TopBar

    -- å…³é—­æŒ‰é’®
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 30, 0, 30)
    CloseButton.Position = UDim2.new(1, -35, 0, 5)
    CloseButton.Text = "Ã—"
    CloseButton.TextColor3 = KRNL_COLORS.TEXT
    CloseButton.TextSize = 24
    CloseButton.BackgroundTransparency = 1
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.ZIndex = 2
    CloseButton.Parent = TopBar

    -- è¯´æ˜æ–‡å­—
    local Description = Instance.new("TextLabel")
    Description.Size = UDim2.new(0.9, 0, 0, 40)
    Description.Position = UDim2.new(0.05, 0, 0.15, 0)
    Description.BackgroundTransparency = 1
    Description.Text = "è¯·è¾“å…¥å¯†é’¥å¼€å§‹ä½¿ç”¨ï¼Œå®Œå…¨å…è´¹ã€‚"
    Description.TextColor3 = KRNL_COLORS.TEXT_SECONDARY
    Description.TextSize = 16
    Description.Font = Enum.Font.Gotham
    Description.TextWrapped = true
    Description.ZIndex = 2
    Description.Parent = MainFrame

    -- å¯†é’¥è¾“å…¥æ¡†
    local KeyBox = Instance.new("TextBox")
    KeyBox.Size = UDim2.new(0.85, 0, 0, 50)
    KeyBox.Position = UDim2.new(0.075, 0, 0.35, 0)
    KeyBox.PlaceholderText = "åœ¨æ­¤å¤„ç²˜è´´æ‚¨çš„å¯†é’¥..."
    KeyBox.Text = ""
    KeyBox.ClearTextOnFocus = false
    KeyBox.TextColor3 = KRNL_COLORS.TEXT
    KeyBox.BackgroundColor3 = KRNL_COLORS.INPUT_BG
    KeyBox.BorderSizePixel = 0
    KeyBox.TextSize = 16
    KeyBox.Font = Enum.Font.Gotham
    KeyBox.ZIndex = 2
    KeyBox.Parent = MainFrame

    local KeyBoxCorner = Instance.new("UICorner")
    KeyBoxCorner.CornerRadius = UDim.new(0, 8)
    KeyBoxCorner.Parent = KeyBox

    local KeyBoxPadding = Instance.new("UIPadding")
    KeyBoxPadding.PaddingLeft = UDim.new(0, 15)
    KeyBoxPadding.PaddingRight = UDim.new(0, 15)
    KeyBoxPadding.Parent = KeyBox

    -- è®°ä½æˆ‘é€‰é¡¹
    local RememberCheckbox = Instance.new("TextButton")
    RememberCheckbox.Size = UDim2.new(0, 20, 0, 20)
    RememberCheckbox.Position = UDim2.new(0.075, 0, 0.6, 0)
    RememberCheckbox.Text = ""
    RememberCheckbox.BackgroundColor3 = KRNL_COLORS.INPUT_BG
    RememberCheckbox.BorderSizePixel = 0
    RememberCheckbox.ZIndex = 2
    RememberCheckbox.Parent = MainFrame

    local CheckboxCorner = Instance.new("UICorner")
    CheckboxCorner.CornerRadius = UDim.new(0, 4)
    CheckboxCorner.Parent = RememberCheckbox

    local RememberLabel = Instance.new("TextLabel")
    RememberLabel.Size = UDim2.new(0, 250, 0, 20)
    RememberLabel.Position = UDim2.new(0.15, 0, 0.6, 0)
    RememberLabel.BackgroundTransparency = 1
    RememberLabel.Text = "è®°ä½æ­¤è®¾å¤‡ (30å¤©å†…æ— éœ€éªŒè¯)"
    RememberLabel.TextColor3 = KRNL_COLORS.TEXT_SECONDARY
    RememberLabel.TextSize = 14
    RememberLabel.TextXAlignment = Enum.TextXAlignment.Left
    RememberLabel.Font = Enum.Font.Gotham
    RememberLabel.ZIndex = 2
    RememberLabel.Parent = MainFrame

    -- éªŒè¯æŒ‰é’®
    local VerifyButton = Instance.new("TextButton")
    VerifyButton.Size = UDim2.new(0.7, 0, 0, 50)
    VerifyButton.Position = UDim2.new(0.15, 0, 0.75, 0)
    VerifyButton.Text = "éªŒè¯å¯†é’¥"
    VerifyButton.TextColor3 = KRNL_COLORS.TEXT
    VerifyButton.BackgroundColor3 = KRNL_COLORS.PRIMARY
    VerifyButton.BorderSizePixel = 0
    VerifyButton.Font = Enum.Font.GothamBold
    VerifyButton.TextSize = 18
    VerifyButton.ZIndex = 2
    VerifyButton.Parent = MainFrame

    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 8)
    ButtonCorner.Parent = VerifyButton

    -- ä¸ºéªŒè¯æŒ‰é’®æ·»åŠ å‘å…‰æ•ˆæœ
    createGlowingBorder(VerifyButton)

    -- åº•éƒ¨æç¤ºæ–‡å­—
    local FooterText = Instance.new("TextLabel")
    FooterText.Size = UDim2.new(0.9, 0, 0, 30)
    FooterText.Position = UDim2.new(0.05, 0, 0.92, 0)
    FooterText.BackgroundTransparency = 1
    FooterText.Text = "ä»æˆ‘ä»¬QQç¾¤è·å–å¯†é’¥-737561425"
    FooterText.TextColor3 = KRNL_COLORS.TEXT_SECONDARY
    FooterText.TextSize = 12
    FooterText.Font = Enum.Font.Gotham
    FooterText.ZIndex = 2
    FooterText.Parent = MainFrame

    -- çŠ¶æ€æ ‡ç­¾
    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Size = UDim2.new(0.8, 0, 0, 20)
    StatusLabel.Position = UDim2.new(0.1, 0, 0.55, 0)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = "å‰©ä½™å°è¯•æ¬¡æ•°: " .. KEY_SYSTEM.MAX_ATTEMPTS
    StatusLabel.TextColor3 = KRNL_COLORS.TEXT_SECONDARY
    StatusLabel.TextSize = 12
    StatusLabel.Font = Enum.Font.Gotham
    StatusLabel.Visible = false
    StatusLabel.ZIndex = 2
    StatusLabel.Parent = MainFrame

    -- äº¤äº’é€»è¾‘
    local attempts = 0
    local rememberMe = false

    -- å¤é€‰æ¡†ç‚¹å‡»äº‹ä»¶
    RememberCheckbox.MouseButton1Click:Connect(function()
        rememberMe = not rememberMe
        if rememberMe then
            RememberCheckbox.BackgroundColor3 = KRNL_COLORS.SUCCESS
            local checkMark = Instance.new("TextLabel")
            checkMark.Size = UDim2.new(1, 0, 1, 0)
            checkMark.Position = UDim2.new(0, 0, 0, 0)
            checkMark.BackgroundTransparency = 1
            checkMark.Text = "âœ“"
            checkMark.TextColor3 = KRNL_COLORS.TEXT
            checkMark.TextSize = 16
            checkMark.Font = Enum.Font.GothamBold
            checkMark.Name = "CheckMark"
            checkMark.ZIndex = 2
            checkMark.Parent = RememberCheckbox
        else
            RememberCheckbox.BackgroundColor3 = KRNL_COLORS.INPUT_BG
            if RememberCheckbox:FindFirstChild("CheckMark") then
                RememberCheckbox.CheckMark:Destroy()
            end
        end
    end)

    -- å¯†é’¥éªŒè¯å‡½æ•°
    local function verifyKey(key)
        for _, validKey in ipairs(KEY_SYSTEM.CORRECT_KEYS) do
            if key == validKey then
                return true
            end
        end
        return false
    end

    -- éªŒè¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    VerifyButton.MouseButton1Click:Connect(function()
        attempts = attempts + 1
        local inputKey = KeyBox.Text
        
        if verifyKey(inputKey) then
            -- éªŒè¯æˆåŠŸ
            if rememberMe and isSupported then
                rememberUser()
            end
            
            -- æˆåŠŸè§†è§‰æ•ˆæœ
            VerifyButton.Text = "éªŒè¯æˆåŠŸ!"
            VerifyButton.BackgroundColor3 = KRNL_COLORS.SUCCESS
            
            -- åŠ è½½ä¸»è„šæœ¬
            task.wait(1.5)
            ScreenGui:Destroy()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/LOL-HUB-BEST-NEW-%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0"))()
        else
            -- éªŒè¯å¤±è´¥
            local remainingAttempts = KEY_SYSTEM.MAX_ATTEMPTS - attempts
            StatusLabel.Text = "å¯†é’¥é”™è¯¯ã€‚å‰©ä½™å°è¯•æ¬¡æ•°: " .. remainingAttempts
            StatusLabel.TextColor3 = KRNL_COLORS.ERROR
            StatusLabel.Visible = true
            
            -- é”™è¯¯è§†è§‰æ•ˆæœ
            VerifyButton.Text = "å¯†é’¥é”™è¯¯"
            VerifyButton.BackgroundColor3 = KRNL_COLORS.ERROR
            
            task.wait(1)
            VerifyButton.Text = "éªŒè¯å¯†é’¥"
            VerifyButton.BackgroundColor3 = KRNL_COLORS.PRIMARY
            
            if remainingAttempts <= 0 then
                game.Players.LocalPlayer:Kick("éªŒè¯å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œè¯·é‡æ–°åŠ å…¥æ¸¸æˆã€‚")
            end
        end
    end)

    -- å…³é—­æŒ‰é’®äº‹ä»¶
    CloseButton.MouseButton1Click:Connect(function()
        game.Players.LocalPlayer:Kick("å·²å–æ¶ˆå¯†é’¥éªŒè¯ã€‚")
    end)

    -- æŒ‰å›è½¦é”®æäº¤
    KeyBox.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            VerifyButton.MouseButton1Click:Wait()
        end
    end)

    -- æŒ‰é’®æ‚¬åœæ•ˆæœ
    VerifyButton.MouseEnter:Connect(function()
        if VerifyButton.BackgroundColor3 == KRNL_COLORS.PRIMARY then
            VerifyButton.BackgroundColor3 = KRNL_COLORS.ACCENT
        end
    end)

    VerifyButton.MouseLeave:Connect(function()
        if VerifyButton.BackgroundColor3 == KRNL_COLORS.ACCENT then
            VerifyButton.BackgroundColor3 = KRNL_COLORS.PRIMARY
        end
    end)

    return ScreenGui
end

-- ä¸»æ‰§è¡Œæµç¨‹
if isUserRemembered() then
    -- ç”¨æˆ·å·²è¢«è®°ä½ï¼Œç›´æ¥åŠ è½½è„šæœ¬
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "LOL HUB",
        Text = "æ¬¢è¿å›æ¥ï¼æ­£åœ¨åŠ è½½è„šæœ¬...",
        Duration = 3
    })
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/LOL-HUB-BEST-NEW-%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0"))()
else
    -- éœ€è¦å¯†é’¥éªŒè¯
    createKeyVerificationGUI()
end
