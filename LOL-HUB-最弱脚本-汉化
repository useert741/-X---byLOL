-- LOL漢化Hub - 完整功能整合版 (LinoriaLib)
-- 作者: LOL漢化組
-- 版本: 2.1 完整版 (新增主頁)
-- 圖片ID: 104039506290166

if not getgenv().LOLHanhuaHub then
    getgenv().LOLHanhuaHub = true
else
    return
end

-- 記錄腳本啟動時間
getgenv().ScriptStartTime = os.time()

-- 繞過反作弊系統
local function BypassAntiCheat()
    local SafeEnv = {}
    setmetatable(SafeEnv, {__index = getgenv()})
    
    SafeEnv.hookfunction = nil
    SafeEnv.getconnections = nil
    SafeEnv.getrawmetatable = nil
    
    local originalNamecall
    originalNamecall = hookmetamethod(game, "__namecall", function(self, ...)
        local method = getnamecallmethod()
        if method == "Kick" or method == "kick" then
            return nil
        end
        return originalNamecall(self, ...)
    end)
    
    local originalIndex
    originalIndex = hookmetamethod(game, "__index", function(self, key)
        if key == "Parent" and self == game then
            return game
        end
        return originalIndex(self, key)
    end)
    
    return SafeEnv
end

local SafeEnvironment = BypassAntiCheat()

-- 加載LinoriaLib
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/mstudio45/LinoriaLib/main/Library.lua"))()
local ThemeManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/mstudio45/LinoriaLib/main/addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/mstudio45/LinoriaLib/main/addons/SaveManager.lua"))()

-- 創建主視窗
local Window = Library:CreateWindow({
    Title = "LOL漢化Hub - v5",
    Footer = "LOL | 新增主頁功能",
    Center = true,
    AutoShow = true,
    Resizable = true,
    ShowCustomCursor = true,
    TabPadding = 8,
    MenuFadeTime = 0.2
})

-- 創建標籤頁 (主頁放在最前面)
local Tabs = {
    Home = Window:AddTab("主頁", "home"),  -- 新增主頁標籤
    Scripts = Window:AddTab("腳本中心", "code"),
    Visuals = Window:AddTab("視覺效果", "eye"),
    Player = Window:AddTab("玩家功能", "user"),
    Combat = Window:AddTab("戰鬥功能", "sword"),
    Aiming = Window:AddTab("自瞄功能", "target"),
    Hitbox = Window:AddTab("碰撞箱擴展", "box"),
    Misc = Window:AddTab("雜項功能", "settings"),
    Settings = Window:AddTab("UI設定", "sliders-horizontal")
}

-- 初始化設定管理
ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)
ThemeManager:SetFolder("LOLHanhuaHub")
SaveManager:SetFolder("LOLHanhuaHub/settings")

-- 主頁功能
local HomeGroup = Tabs.Home:AddLeftGroupbox("玩家信息", "user")

-- 玩家基本信息
local player = game.Players.LocalPlayer
local playerId = player.UserId
local accountAge = player.AccountAge
local membershipType = player.MembershipType.Name

-- 計算帳號創建時間
local createDate = os.date("%Y/%m/%d", os.time() - (accountAge * 24 * 60 * 60))

HomeGroup:AddLabel("玩家名稱: " .. player.Name)
HomeGroup:AddLabel("玩家ID: " .. playerId)
HomeGroup:AddLabel("帳號年齡: " .. accountAge .. " 天")
HomeGroup:AddLabel("帳號創建: " .. createDate)

-- 顯示當前角色狀態
local function updateCharacterInfo()
    local character = player.Character
    if character and character:FindFirstChild("Humanoid") then
        local humanoid = character.Humanoid
        local health = math.floor(humanoid.Health)
        local maxHealth = math.floor(humanoid.MaxHealth)
        return string.format("生命值: %d/%d | 狀態: %s", health, maxHealth, humanoid:GetState().Name)
    else
        return "角色未加載或不存在"
    end
end

local characterInfoLabel = HomeGroup:AddLabel(updateCharacterInfo())

-- 定期更新角色信息
coroutine.wrap(function()
    while true do
        wait(2)
        characterInfoLabel:SetText(updateCharacterInfo())
    end
end)()

-- 注入器信息
local InjectorGroup = Tabs.Home:AddRightGroupbox("注入器信息", "cpu")

-- 檢測常見的注入器特徵
local function getInjectorInfo()
    local injectorInfo = "未知注入器"
    
    -- 檢測Synapse X
    if syn and syn.protect_gui then
        injectorInfo = "Synapse X"
    -- 檢測ScriptWare
    elseif identifyexecutor and string.find(string.lower(identifyexecutor()), "scriptware") then
        injectorInfo = "ScriptWare"
    -- 檢測Krnl
    elseif KRNL_LOADED then
        injectorInfo = "Krnl"
    -- 檢測Fluxus
    elseif getexecutorname and string.find(string.lower(getexecutorname()), "fluxus") then
        injectorInfo = "Fluxus"
    -- 檢測其他常見注入器
    elseif is_sirhurt_closure then
        injectorInfo = "SirHurt"
    elseif PROTOSMASHER_LOADED then
        injectorInfo = "ProtoSmasher"
    elseif checkclosure then
        injectorInfo = "自定義注入器"
    end
    
    return injectorInfo
end

local injectorName = getInjectorInfo()
InjectorGroup:AddLabel("注入器: " .. injectorName)

-- 檢測腳本環境信息
local environmentInfo = ""
if getgenv then
    environmentInfo = environmentInfo .. "getgenv: ✓ | "
end
if getreg then
    environmentInfo = environmentInfo .. "getreg: ✓ | "
end
if getgc then
    environmentInfo = environmentInfo .. "getgc: ✓ | "
end

InjectorGroup:AddLabel("環境功能: " .. environmentInfo)

-- 內存使用情況
local function getMemoryUsage()
    local memory = collectgarbage("count")
    return string.format("%.2f MB", memory / 1024)
end

InjectorGroup:AddLabel("內存使用: " .. getMemoryUsage())

-- 腳本使用時間
local ScriptTimeGroup = Tabs.Home:AddLeftGroupbox("腳本使用信息", "clock")

-- 計算使用時間
local function getScriptUptime()
    local currentTime = os.time()
    local uptime = currentTime - getgenv().ScriptStartTime
    
    local hours = math.floor(uptime / 3600)
    local minutes = math.floor((uptime % 3600) / 60)
    local seconds = uptime % 60
    
    return string.format("%02d:%02d:%02d", hours, minutes, seconds)
end

ScriptTimeGroup:AddLabel("啟動時間: " .. os.date("%Y/%m/%d %H:%M:%S", getgenv().ScriptStartTime))
local uptimeLabel = ScriptTimeGroup:AddLabel("運行時間: " .. getScriptUptime())

-- 更新運行時間
coroutine.wrap(function()
    while true do
        wait(1)
        uptimeLabel:SetText("運行時間: " .. getScriptUptime())
    end
end)()

-- 作者信息
local AuthorGroup = Tabs.Home:AddRightGroupbox("作者信息", "heart")

AuthorGroup:AddLabel("作者: LOL")
AuthorGroup:AddLabel("版本: v5 ")
AuthorGroup:AddLabel("更新日期: 2025年")
AuthorGroup:AddLabel("特別感謝: 无")

AuthorGroup:AddButton("複製作者信息", function()
    local authorInfo = [[
LOL漢化Hub - v5
作者: LOL
版本: v5
功能: 多遊戲腳本整合、視覺效果、玩家功能、戰鬥輔助等
    ]]
    if setclipboard then
        setclipboard(authorInfo)
        Library:Notify("作者信息已複製到剪貼板", 3)
    end
end)

-- 快速功能按鈕
local QuickActionsGroup = Tabs.Home:AddLeftGroupbox("快速操作", "zap")

QuickActionsGroup:AddButton("刷新玩家信息", function()
    characterInfoLabel:SetText(updateCharacterInfo())
    Library:Notify("玩家信息已刷新", 2)
end)

QuickActionsGroup:AddButton("檢查更新", function()
    Library:Notify("當前已是最新版本: v5", 3)
end)

QuickActionsGroup:AddButton("服務器狀態", function()
    local players = game.Players
    local lighting = game:GetService("Lighting")
    
    local serverInfo = string.format([[
服務器狀態:
在線玩家: %d/%d
Ping: 計算中...
服務器時間: %.1f小時
    ]],
    #players:GetPlayers(),
    players.MaxPlayers,
    lighting:GetMinutesAfterMidnight() / 60
    )
    
    Library:Notify(serverInfo, 5)
end)

-- 在標題欄添加圖片
local function AddImageToTitleBar()
    wait(1)
    
    local mainContainer = Window.Container
    if not mainContainer then return end
    
    local titleBar = mainContainer:FindFirstChild("TopBar")
    if not titleBar then return end
    
    local originalTitle = titleBar:FindFirstChild("WindowTitle")
    if originalTitle then
        originalTitle.Visible = false
        
        local titleContainer = Instance.new("Frame")
        titleContainer.Name = "CustomTitleContainer"
        titleContainer.BackgroundTransparency = 1
        titleContainer.Size = UDim2.new(1, -40, 1, 0)
        titleContainer.Position = UDim2.new(0, 40, 0, 0)
        titleContainer.Parent = titleBar
        
        -- 使用新圖片ID
        local titleImage = Instance.new("ImageLabel")
        titleImage.Name = "TitleImage"
        titleImage.Image = "http://www.roblox.com/asset/?id=104039506290166"
        titleImage.BackgroundTransparency = 1
        titleImage.Size = UDim2.new(0, 25, 0, 25)
        titleImage.Position = UDim2.new(0, 10, 0.5, -12.5)
        titleImage.Parent = titleContainer
        
        local titleLabel = Instance.new("TextLabel")
        titleLabel.Name = "CustomTitle"
        titleLabel.Text = "LOL漢化Hub - 完整整合版 v2.1"
        titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        titleLabel.TextSize = 16
        titleLabel.Font = Enum.Font.GothamBold
        titleLabel.BackgroundTransparency = 1
        titleLabel.Size = UDim2.new(1, -40, 1, 0)
        titleLabel.Position = UDim2.new(0, 40, 0, 0)
        titleLabel.TextXAlignment = Enum.TextXAlignment.Left
        titleLabel.Parent = titleContainer
        
        local subtitleLabel = Instance.new("TextLabel")
        subtitleLabel.Name = "Subtitle"
        subtitleLabel.Text = "v2.1 | 新增主頁功能 | 圖片ID: 104039506290166"
        subtitleLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        subtitleLabel.TextSize = 10
        subtitleLabel.Font = Enum.Font.Gotham
        subtitleLabel.BackgroundTransparency = 1
        subtitleLabel.Size = UDim2.new(1, -40, 0, 12)
        subtitleLabel.Position = UDim2.new(0, 40, 1, -12)
        subtitleLabel.TextXAlignment = Enum.TextXAlignment.Left
        subtitleLabel.Parent = titleContainer
    end
end

task.spawn(AddImageToTitleBar)

-- 腳本中心功能
local ScriptsGroup = Tabs.Scripts:AddLeftGroupbox("遊戲腳本", "gamepad")

ScriptsGroup:AddButton("Fartsaken被遺棄", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/Fartsaken-LOL-QQ737561425"))()
    Library:Notify("Fartsaken腳本已加載", 3)
end)

ScriptsGroup:AddButton("BronxWare 99 Nights漢化", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/BronxWare99Nights-LOL"))()
    Library:Notify("BronxWare腳本已加載", 3)
end)

ScriptsGroup:AddButton("Doors XA Hub", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/DoorsXAHubLOL"))()
    Library:Notify("Doors XA Hub腳本已加載", 3)
end)

ScriptsGroup:AddButton("住宅大屠殺", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/LOLHANHUA"))()
    Library:Notify("住宅大屠殺腳本已加載", 3)
end)

ScriptsGroup:AddButton("Red Hub(死亡之死LOL漢化)", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/Death%20is%20die"))()
    Library:Notify("Red Hub腳本已加載", 3)
end)

ScriptsGroup:AddButton("UNDETECTEDWARE犯罪(半漢化)", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/UNDETECTEDWARE-LOLHAZNHUA"))()
    Library:Notify("UNDETECTEDWARE腳本已加載", 3)
end)

-- 工具腳本
local ToolsGroup = Tabs.Scripts:AddRightGroupbox("工具腳本", "wrench")

ToolsGroup:AddButton("戰鬥入門", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E6%88%98%E6%96%97%E5%85%A5%E9%97%A8-Introduction%20to%20combat"))()
    Library:Notify("戰鬥入門腳本已加載", 3)
end)

ToolsGroup:AddButton("飛行腳本", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E6%B1%89%E5%8C%96%E9%A3%9E%E8%A1%8C"))()
    Library:Notify("飛行功能已啟用", 3)
end)

ToolsGroup:AddButton("甩人腳本", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E7%94%A9%E4%BA%BA%E6%B1%89%E5%8C%96"))()
    Library:Notify("甩人功能已啟用", 3)
end)

ToolsGroup:AddButton("時間回溯", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E5%9B%9E%E6%BA%AF%E6%97%B6%E9%97%B4LOL"))()
    Library:Notify("時間回溯功能已啟用", 3)
end)

ToolsGroup:AddButton("無敵少俠飛行r15", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/invincible-FLY"))()
    Library:Notify("無敵少俠飛行已啟用", 3)
end)

ToolsGroup:AddButton("甩飛腳本", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/0Ben1/fe./main/Fling%20GUI"))()
    Library:Notify("甩飛腳本已加載", 3)
end)

ToolsGroup:AddButton("力量傳奇腳本", function()
    local GS,functions=function(...)return game:GetService(...) end,{};
    local ReplicatedStorage,ren=GS'ReplicatedStorage',GS'Players'.LocalPlayer
    function functions:event(name)return ReplicatedStorage.rEvents.orbEvent:FireServer('collectOrb',name,'City');end
    task.spawn(function()
    ren.Character.Head:Destroy();end)
    getgenv().AllToggle=false
    getgenv().Orange=true
    getgenv().Hoop=true
    getgenv().Gem=true
    getgenv().Red=true
    getgenv().Yellow=true
    getgenv().Blue=true
    spawn(function()
    if getenv().AllToggle==true then
    getgenv().Orange=false
    getgenv().Hoop=false
    getgenv().Gem=false
    getgenv().Red=false
    getgenv().Yellow=false
    getgenv().Blue=false
    end
    end)
    spawn(function()while getgenv().Orange==true do wait() functions:event('Orange Orb');end;end)
    spawn(function()while getgenv().Red==true do wait() functions:event('Red Orb');end;end)
    spawn(function()while getgenv().Yellow==true do wait() functions:event('Yellow Orb');end;end)
    spawn(function()while getgenv().Blue==true do wait() functions:event('Blue Orb');end;end)
    spawn(function()while getgenv().Gem==true do wait() functions:event('Gem');end;end)
    spawn(function()while getgenv().Hoop==true do wait() for _,v in ipairs(workspace.Hoops:GetChildren()) do if v.Name=='Hoop' then v.CFrame=ren.Character.HumanoidRootPart.CFrame;v.Transparency=0;wait();end;end;end;end)
    Library:Notify("力量傳奇腳本已加載", 3)
end)

-- 視覺效果功能
local lighting = game:GetService("Lighting")

-- 光照效果
local LightingGroup = Tabs.Visuals:AddLeftGroupbox("光照效果", "sun")

LightingGroup:AddSlider("ExposureSlider", {
    Text = "曝光度",
    Default = 1,
    Min = 0,
    Max = 10,
    Rounding = 1,
    Callback = function(value)
        lighting.ExposureCompensation = value - 1
    end
})

LightingGroup:AddSlider("BrightnessSlider", {
    Text = "亮度",
    Default = 1,
    Min = 0,
    Max = 2,
    Rounding = 1,
    Callback = function(value)
        if not lighting:FindFirstChild("ColorCorrection_Brightness") then
            local cc = Instance.new("ColorCorrectionEffect")
            cc.Name = "ColorCorrection_Brightness"
            cc.Parent = lighting
        end
        lighting.ColorCorrection_Brightness.Brightness = (value - 1) * 0.3
    end
})

LightingGroup:AddSlider("ContrastSlider", {
    Text = "對比度",
    Default = 1,
    Min = 0,
    Max = 2,
    Rounding = 1,
    Callback = function(value)
        if not lighting:FindFirstChild("ColorCorrection_Contrast") then
            local cc = Instance.new("ColorCorrectionEffect")
            cc.Name = "ColorCorrection_Contrast"
            cc.Parent = lighting
        end
        lighting.ColorCorrection_Contrast.Contrast = (value - 1) * 0.5
    end
})

LightingGroup:AddSlider("SaturationSlider", {
    Text = "飽和度",
    Default = 1,
    Min = 0,
    Max = 2,
    Rounding = 1,
    Callback = function(value)
        if not lighting:FindFirstChild("ColorCorrection_Saturation") then
            local cc = Instance.new("ColorCorrectionEffect")
            cc.Name = "ColorCorrection_Saturation"
            cc.Parent = lighting
        end
        lighting.ColorCorrection_Saturation.Saturation = value - 1
    end
})

-- 後處理效果
local PostProcessGroup = Tabs.Visuals:AddRightGroupbox("後處理效果", "sliders")

PostProcessGroup:AddSlider("BloomSlider", {
    Text = "高光強度",
    Default = 1,
    Min = 0,
    Max = 2,
    Rounding = 1,
    Callback = function(value)
        if not lighting:FindFirstChild("BloomEffect") then
            local bloom = Instance.new("BloomEffect")
            bloom.Parent = lighting
        end
        lighting.BloomEffect.Intensity = (value - 1) * 0.5
    end
})

PostProcessGroup:AddSlider("TemperatureSlider", {
    Text = "色溫",
    Default = 1,
    Min = 0,
    Max = 2,
    Rounding = 1,
    Callback = function(value)
        if not lighting:FindFirstChild("ColorCorrection_Temperature") then
            local cc = Instance.new("ColorCorrectionEffect")
            cc.Name = "ColorCorrection_Temperature"
            cc.Parent = lighting
        end
        local coldColor = Color3.fromRGB(180, 220, 255)
        local warmColor = Color3.fromRGB(255, 220, 180)
        lighting.ColorCorrection_Temperature.TintColor = coldColor:Lerp(warmColor, value - 1)
    end
})

-- ESP透視功能
local espEnabled = false
local espBoxes = {}

local ESPGroup = Tabs.Visuals:AddLeftGroupbox("ESP透視", "eye")

ESPGroup:AddToggle("PlayerESP", {
    Text = "玩家ESP",
    Default = false,
    Callback = function(value)
        espEnabled = value
        
        if value then
            local function createESP(player)
                if player == game.Players.LocalPlayer then return end
                
                local character = player.Character
                if not character then return end
                
                local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                if not humanoidRootPart then return end
                
                local box = Instance.new("BoxHandleAdornment")
                box.Name = "ESP_" .. player.Name
                box.Adornee = humanoidRootPart
                box.AlwaysOnTop = true
                box.ZIndex = 10
                box.Size = Vector3.new(4, 6, 2)
                box.Color3 = Color3.fromRGB(255, 0, 0)
                box.Transparency = 0.2
                box.Parent = humanoidRootPart
                
                local billboard = Instance.new("BillboardGui")
                billboard.Name = "ESP_Name_" .. player.Name
                billboard.Adornee = humanoidRootPart
                billboard.Size = UDim2.new(0, 200, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 3.5, 0)
                billboard.AlwaysOnTop = true
                
                local nameLabel = Instance.new("TextLabel")
                nameLabel.Size = UDim2.new(1, 0, 1, 0)
                nameLabel.BackgroundTransparency = 1
                nameLabel.Text = player.Name
                nameLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                nameLabel.TextStrokeTransparency = 0
                nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                nameLabel.TextSize = 14
                nameLabel.Font = Enum.Font.GothamBold
                nameLabel.Parent = billboard
                
                billboard.Parent = humanoidRootPart
                
                espBoxes[player] = {box = box, billboard = billboard}
            end
            
            for _, player in ipairs(game.Players:GetPlayers()) do
                createESP(player)
            end
            
            game.Players.PlayerAdded:Connect(function(player)
                player.CharacterAdded:Connect(function(character)
                    wait(1)
                    createESP(player)
                end)
            end)
            
        else
            for player, espObjects in pairs(espBoxes) do
                if espObjects.box then espObjects.box:Destroy() end
                if espObjects.billboard then espObjects.billboard:Destroy() end
            end
            espBoxes = {}
        end
    end
})

-- 玩家功能
local MovementGroup = Tabs.Player:AddLeftGroupbox("移動功能", "move")

local speedEnabled = false

MovementGroup:AddToggle("SpeedToggle", {
    Text = "速度修改",
    Default = false,
    Callback = function(value)
        speedEnabled = value
        if value then
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = 50
            end
        else
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = 16
            end
        end
    end
})

MovementGroup:AddSlider("WalkSpeed", {
    Text = "移動速度",
    Default = 50,
    Min = 16,
    Max = 100,
    Rounding = 1,
    Callback = function(value)
        if speedEnabled then
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = value
            end
        end
    end
})

MovementGroup:AddSlider("JumpPower", {
    Text = "跳躍高度",
    Default = 50,
    Min = 50,
    Max = 200,
    Rounding = 1,
    Callback = function(value)
        local character = game.Players.LocalPlayer.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.JumpPower = value
        end
    end
})

-- 實用功能
local UtilityGroup = Tabs.Player:AddRightGroupbox("實用功能", "zap")

local noclipEnabled = false
local noclipConnection = nil

UtilityGroup:AddToggle("NoclipToggle", {
    Text = "穿牆模式",
    Default = false,
    Callback = function(value)
        noclipEnabled = value
        
        if value then
            noclipConnection = game:GetService("RunService").Stepped:Connect(function()
                if not noclipEnabled then return end
                
                local character = game.Players.LocalPlayer.Character
                if not character then return end
                
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        part.CanCollide = false
                    end
                end
            end)
        else
            if noclipConnection then
                noclipConnection:Disconnect()
                noclipConnection = nil
            end
        end
    end
})

UtilityGroup:AddToggle("InfiniteJump", {
    Text = "無限跳躍",
    Default = false,
    Callback = function(value)
        if value then
            game:GetService("UserInputService").JumpRequest:Connect(function()
                local character = game.Players.LocalPlayer.Character
                if character and character:FindFirstChild("Humanoid") then
                    character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end)
        end
    end
})

-- 靈魂出竅功能
local outOfBodyEnabled = false
local originalCharacter = nil
local soulPart = nil
local soulBody = nil
local soulControl = nil

local OutOfBodyGroup = Tabs.Player:AddLeftGroupbox("靈魂出竅", "ghost")

OutOfBodyGroup:AddToggle("OutOfBody", {
    Text = "靈魂出竅模式",
    Default = false,
    Callback = function(value)
        outOfBodyEnabled = value
        
        if value then
            originalCharacter = game.Players.LocalPlayer.Character
            
            soulPart = Instance.new("Part")
            soulPart.Name = "Soul"
            soulPart.Size = Vector3.new(2, 2, 2)
            soulPart.Position = originalCharacter.HumanoidRootPart.Position + Vector3.new(0, 5, 0)
            soulPart.Anchored = false
            soulPart.CanCollide = false
            soulPart.Transparency = 0.5
            soulPart.Material = Enum.Material.Neon
            soulPart.BrickColor = BrickColor.new("Bright blue")
            soulPart.Parent = workspace
            
            soulBody = Instance.new("BodyGyro")
            soulBody.MaxTorque = Vector3.new(400000, 400000, 400000)
            soulBody.P = 10000
            soulBody.Parent = soulPart
            
            soulControl = Instance.new("BodyVelocity")
            soulControl.MaxForce = Vector3.new(400000, 400000, 400000)
            soulControl.Velocity = Vector3.new(0, 0, 0)
            soulControl.Parent = soulPart
            
            workspace.CurrentCamera.CameraSubject = soulPart
            
            local connection
            connection = game:GetService("RunService").RenderStepped:Connect(function()
                if not outOfBodyEnabled then
                    connection:Disconnect()
                    return
                end
                
                local camera = workspace.CurrentCamera
                local lookVector = camera.CFrame.LookVector
                local rightVector = camera.CFrame.RightVector
                local upVector = camera.CFrame.UpVector
                
                local speed = 50
                local moveDirection = Vector3.new(0, 0, 0)
                
                if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.W) then
                    moveDirection = moveDirection + lookVector
                end
                if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.S) then
                    moveDirection = moveDirection - lookVector
                end
                if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.A) then
                    moveDirection = moveDirection - rightVector
                end
                if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.D) then
                    moveDirection = moveDirection + rightVector
                end
                if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.Space) then
                    moveDirection = moveDirection + Vector3.new(0, 1, 0)
                end
                if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.LeftShift) then
                    moveDirection = moveDirection - Vector3.new(0, 1, 0)
                end
                
                if moveDirection.Magnitude > 0 then
                    soulControl.Velocity = moveDirection.Unit * speed
                else
                    soulControl.Velocity = Vector3.new(0, 0, 0)
                end
                
                soulBody.CFrame = CFrame.new(soulPart.Position, soulPart.Position + lookVector)
            end)
            
            Library:Notify("靈魂出竅模式已啟用！使用WASD移動，空格上升，Shift下降", 5)
        else
            if originalCharacter then
                workspace.CurrentCamera.CameraSubject = originalCharacter.Humanoid
            end
            
            if soulPart then soulPart:Destroy() end
            if soulBody then soulBody:Destroy() end
            if soulControl then soulControl:Destroy() end
            
            Library:Notify("靈魂出竅模式已禁用", 3)
        end
    end
})

OutOfBodyGroup:AddSlider("SoulSpeed", {
    Text = "靈魂移動速度",
    Default = 50,
    Min = 10,
    Max = 100,
    Rounding = 1
})

OutOfBodyGroup:AddToggle("SoulNoclip", {
    Text = "靈魂穿牆",
    Default = true
})

-- 無敵模式功能
local godModeEnabled = false
local godModeConnections = {}

local GodModeGroup = Tabs.Player:AddLeftGroupbox("無敵模式", "shield")

GodModeGroup:AddToggle("GodMode", {
    Text = "無敵模式",
    Default = false,
    Callback = function(value)
        godModeEnabled = value
        
        if value then
            local player = game.Players.LocalPlayer
            
            local function setupGodMode(character)
                local humanoid = character:FindFirstChild("Humanoid")
                if humanoid then
                    humanoid.MaxHealth = math.huge
                    humanoid.Health = math.huge
                    
                    local healthLoop = game:GetService("RunService").Heartbeat:Connect(function()
                        if not godModeEnabled then
                            healthLoop:Disconnect()
                            return
                        end
                        
                        if humanoid and humanoid.Health < math.huge then
                            humanoid.Health = math.huge
                        end
                    end)
                    
                    local healthConnection = humanoid.HealthChanged:Connect(function(newHealth)
                        if not godModeEnabled then return end
                        
                        if newHealth < math.huge then
                            humanoid.Health = math.huge
                        end
                    end)
                    
                    table.insert(godModeConnections, healthLoop)
                    table.insert(godModeConnections, healthConnection)
                end
            end
            
            if player.Character then
                setupGodMode(player.Character)
            end
            
            local characterAddedConnection = player.CharacterAdded:Connect(function(character)
                wait(1)
                if godModeEnabled then
                    setupGodMode(character)
                end
            end)
            
            table.insert(godModeConnections, characterAddedConnection)
            
            Library:Notify("無敵模式已啟用！生命值將持續恢復", 5)
            
        else
            for _, connection in ipairs(godModeConnections) do
                if connection and typeof(connection) == "RBXScriptConnection" then
                    connection:Disconnect()
                end
            end
            godModeConnections = {}
            
            local player = game.Players.LocalPlayer
            if player.Character then
                local humanoid = player.Character:FindFirstChild("Humanoid")
                if humanoid then
                    humanoid.MaxHealth = 100
                    humanoid.Health = 100
                end
            end
            
            Library:Notify("無敵模式已禁用", 3)
        end
    end
})

-- 自瞄功能
local aimbotEnabled = false
local aimbotConnection = nil

local AimbotSettingsGroup = Tabs.Aiming:AddLeftGroupbox("自瞄設定", "settings")

AimbotSettingsGroup:AddToggle("AimbotEnabled", {
    Text = "啟用自瞄",
    Default = false,
    Callback = function(value)
        aimbotEnabled = value
        
        if value then
            aimbotConnection = game:GetService("RunService").RenderStepped:Connect(function()
                if not aimbotEnabled then return end
                
                local player = game.Players.LocalPlayer
                local character = player.Character
                local camera = workspace.CurrentCamera
                
                if not character or not camera then return end
                
                local rootPart = character:FindFirstChild("HumanoidRootPart")
                if not rootPart then return end
                
                local bestTarget = nil
                local closestDistance = 1000
                
                for _, targetPlayer in ipairs(game.Players:GetPlayers()) do
                    if targetPlayer ~= player and targetPlayer.Character then
                        local targetCharacter = targetPlayer.Character
                        local targetHumanoid = targetCharacter:FindFirstChild("Humanoid")
                        local targetRoot = targetCharacter:FindFirstChild("HumanoidRootPart")
                        
                        if targetHumanoid and targetHumanoid.Health > 0 and targetRoot then
                            local distance = (rootPart.Position - targetRoot.Position).Magnitude
                            
                            local screenPoint, onScreen = camera:WorldToViewportPoint(targetRoot.Position)
                            if onScreen then
                                local mouse = game:GetService("UserInputService"):GetMouseLocation()
                                local distanceToCenter = (Vector2.new(screenPoint.X, screenPoint.Y) - Vector2.new(mouse.X, mouse.Y)).Magnitude
                                
                                if distanceToCenter < closestDistance then
                                    closestDistance = distanceToCenter
                                    bestTarget = targetCharacter
                                end
                            end
                        end
                    end
                end
                
                if bestTarget then
                    local targetPart = bestTarget:FindFirstChild("Head") or bestTarget:FindFirstChild("HumanoidRootPart")
                    if targetPart then
                        local camera = workspace.CurrentCamera
                        local aimPosition = targetPart.Position
                        
                        local currentCFrame = camera.CFrame
                        local targetCFrame = CFrame.lookAt(camera.CFrame.Position, aimPosition)
                        
                        camera.CFrame = currentCFrame:Lerp(targetCFrame, 0.1)
                    end
                end
            end)
        else
            if aimbotConnection then
                aimbotConnection:Disconnect()
                aimbotConnection = nil
            end
        end
    end
})

AimbotSettingsGroup:AddSlider("AimbotFOV", {
    Text = "自瞄FOV",
    Default = 100,
    Min = 10,
    Max = 500,
    Rounding = 1
})

AimbotSettingsGroup:AddSlider("AimbotSmoothness", {
    Text = "瞄準平滑度",
    Default = 10,
    Min = 1,
    Max = 30,
    Rounding = 1
})

-- 戰鬥功能
local CombatGroup = Tabs.Combat:AddLeftGroupbox("戰鬥設定", "target")

local killAuraEnabled = false
local killAuraRange = 20

CombatGroup:AddToggle("KillAura", {
    Text = "殺戮光環",
    Default = false,
    Callback = function(value)
        killAuraEnabled = value
        
        if value then
            coroutine.wrap(function()
                while killAuraEnabled do
                    wait(0.1)
                    
                    local localPlayer = game.Players.LocalPlayer
                    local localCharacter = localPlayer.Character
                    
                    if localCharacter and localCharacter:FindFirstChild("HumanoidRootPart") then
                        local localRoot = localCharacter.HumanoidRootPart
                        
                        for _, player in ipairs(game.Players:GetPlayers()) do
                            if player ~= localPlayer then
                                local character = player.Character
                                if character and character:FindFirstChild("HumanoidRootPart") then
                                    local targetRoot = character.HumanoidRootPart
                                    local distance = (localRoot.Position - targetRoot.Position).Magnitude
                                    
                                    if distance <= killAuraRange then
                                        localRoot.CFrame = targetRoot.CFrame
                                    end
                                end
                            end
                        end
                    end
                end
            end)()
        end
    end
})

CombatGroup:AddSlider("KillAuraRange", {
    Text = "殺戮光環範圍",
    Default = 20,
    Min = 5,
    Max = 50,
    Rounding = 1,
    Callback = function(value)
        killAuraRange = value
    end
})

-- 甩飛功能
local flingEnabled = false
local flingConnection = nil

local FlingGroup = Tabs.Combat:AddRightGroupbox("甩飛功能", "wind")

FlingGroup:AddToggle("FlingToggle", {
    Text = "甩飛模式",
    Default = false,
    Callback = function(value)
        flingEnabled = value
        
        if value then
            flingConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if not flingEnabled then return end
                
                local localPlayer = game.Players.LocalPlayer
                local localCharacter = localPlayer.Character
                
                if not localCharacter then return end
                
                local localRoot = localCharacter:FindFirstChild("HumanoidRootPart")
                if not localRoot then return end
                
                for _, player in ipairs(game.Players:GetPlayers()) do
                    if player ~= localPlayer then
                        local character = player.Character
                        if character and character:FindFirstChild("HumanoidRootPart") then
                            local targetRoot = character.HumanoidRootPart
                            local distance = (localRoot.Position - targetRoot.Position).Magnitude
                            
                            if distance < 20 then
                                local flingDirection = (targetRoot.Position - localRoot.Position).Unit
                                targetRoot.Velocity = flingDirection * 5000 + Vector3.new(0, 2000, 0)
                            end
                        end
                    end
                end
            end)
            
            Library:Notify("甩飛模式已啟用 - 甩飛其他玩家", 3)
        else
            if flingConnection then
                flingConnection:Disconnect()
                flingConnection = nil
            end
            Library:Notify("甩飛模式已禁用", 3)
        end
    end
})

FlingGroup:AddSlider("FlingPower", {
    Text = "甩飛力度",
    Default = 5000,
    Min = 1000,
    Max = 10000,
    Rounding = 1
})

FlingGroup:AddSlider("FlingRange", {
    Text = "甩飛範圍",
    Default = 20,
    Min = 5,
    Max = 50,
    Rounding = 1
})

-- 防甩飛功能
local antiFlingEnabled = false
local antiFlingConnection = nil

local DefenseGroup = Tabs.Combat:AddRightGroupbox("防禦功能", "shield")

DefenseGroup:AddToggle("AntiFling", {
    Text = "防甩飛",
    Default = false,
    Callback = function(value)
        antiFlingEnabled = value
        
        if value then
            local player = game.Players.LocalPlayer
            local character = player.Character
            
            if character then
                local rootPart = character:FindFirstChild("HumanoidRootPart")
                if rootPart then
                    rootPart:SetNetworkOwner(nil)
                end
            end
            
            antiFlingConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if not antiFlingEnabled then return end
                
                local currentCharacter = player.Character
                if not currentCharacter then return end
                
                local humanoid = currentCharacter:FindFirstChild("Humanoid")
                local rootPart = currentCharacter:FindFirstChild("HumanoidRootPart")
                
                if humanoid and rootPart then
                    local velocity = rootPart.Velocity
                    local rotVelocity = rootPart.RotVelocity
                    
                    if velocity.Magnitude > 100 or rotVelocity.Magnitude > 50 then
                        rootPart.Velocity = Vector3.new(0, 0, 0)
                        rootPart.RotVelocity = Vector3.new(0, 0, 0)
                        rootPart.Anchored = true
                        wait(0.05)
                        rootPart.Anchored = false
                        rootPart:SetNetworkOwner(nil)
                    end
                    
                    if math.abs(rotVelocity.X) > 10 or math.abs(rotVelocity.Y) > 10 or math.abs(rotVelocity.Z) > 10 then
                        rootPart.RotVelocity = Vector3.new(0, 0, 0)
                    end
                    
                    if rootPart.Position.Y < -500 or rootPart.Position.Y > 1000 then
                        rootPart.CFrame = CFrame.new(0, 50, 0)
                    end
                end
            end)
            
            Library:Notify("防甩飛已啟用", 3)
        else
            if antiFlingConnection then
                antiFlingConnection:Disconnect()
                antiFlingConnection = nil
            end
            Library:Notify("防甩飛已禁用", 3)
        end
    end
})

-- 碰撞箱擴展功能
local hitboxEnabled = false
local originalSizes = {}

local HitboxGroup = Tabs.Hitbox:AddLeftGroupbox("碰撞箱擴展", "box")

HitboxGroup:AddToggle("HitboxToggle", {
    Text = "啟用碰撞箱擴展",
    Default = false,
    Callback = function(value)
        hitboxEnabled = value
        if value then
            expandHitboxes()
            Library:Notify("碰撞箱擴展已啟用", 3)
        else
            restoreHitboxes()
            Library:Notify("碰撞箱擴展已禁用", 3)
        end
    end
})

HitboxGroup:AddSlider("HitboxSize", {
    Text = "碰撞箱大小",
    Default = 10,
    Min = 5,
    Max = 50,
    Rounding = 1,
    Callback = function(value)
        if hitboxEnabled then
            expandHitboxes()
        end
    end
})

HitboxGroup:AddToggle("HitboxTeamCheck", {
    Text = "忽略隊友",
    Default = true
})

HitboxGroup:AddToggle("HitboxVisible", {
    Text = "顯示碰撞箱",
    Default = true
})

function expandHitboxes()
    local players = game:GetService("Players"):GetPlayers()
    local localPlayer = game.Players.LocalPlayer
    local hitboxSize = Options.HitboxSize and Options.HitboxSize.Value or 10
    local ignoreTeam = Options.HitboxTeamCheck and Options.HitboxTeamCheck.Value or true
    
    for _, player in pairs(players) do
        if player ~= localPlayer then
            local character = player.Character
            if character then
                if ignoreTeam and player.Team == localPlayer.Team then
                    continue
                end
                
                local parts = {
                    "Head",
                    "HumanoidRootPart", 
                    "Torso",
                    "UpperTorso",
                    "LowerTorso"
                }
                
                for _, partName in pairs(parts) do
                    local part = character:FindFirstChild(partName)
                    if part and part:IsA("BasePart") then
                        if not originalSizes[player] then
                            originalSizes[player] = {}
                        end
                        if not originalSizes[player][partName] then
                            originalSizes[player][partName] = part.Size
                        end
                        
                        part.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize)
                        
                        if Options.HitboxVisible and Options.HitboxVisible.Value then
                            part.Transparency = 0.5
                            part.Material = Enum.Material.Neon
                            part.BrickColor = BrickColor.new("Bright red")
                        else
                            part.Transparency = 1
                        end
                    end
                end
            end
        end
    end
end

function restoreHitboxes()
    for player, parts in pairs(originalSizes) do
        if player and player.Character then
            for partName, originalSize in pairs(parts) do
                local part = player.Character:FindFirstChild(partName)
                if part and part:IsA("BasePart") then
                    part.Size = originalSize
                    part.Transparency = 0
                    part.Material = Enum.Material.Plastic
                end
            end
        end
    end
    originalSizes = {}
end

-- 雜項功能
local ToolsGroup = Tabs.Misc:AddLeftGroupbox("實用工具", "tool")

ToolsGroup:AddButton("點擊傳送工具", function()
    local mouse = game.Players.LocalPlayer:GetMouse()
    local tool = Instance.new("Tool")
    tool.RequiresHandle = false
    tool.Name = "LOL點擊傳送"
    tool.Activated:connect(function()
        local pos = mouse.Hit+Vector3.new(0,2.5,0)
        pos = CFrame.new(pos.X,pos.Y,pos.Z)
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = pos
    end)
    tool.Parent = game.Players.LocalPlayer.Backpack
    
    Library:Notify("點擊傳送工具已添加到背包", 3)
end)

ToolsGroup:AddButton("移除碰撞箱", function()
    local player = game.Players.LocalPlayer
    local character = player.Character
    
    if character then
        for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
        
        character.DescendantAdded:Connect(function(part)
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end)
        
        Library:Notify("玩家碰撞箱已移除", 3)
    end
end)

ToolsGroup:AddButton("修復遊戲相機", function()
    local camera = workspace.CurrentCamera
    if camera then
        camera.CameraType = Enum.CameraType.Custom
        if game.Players.LocalPlayer.Character then
            camera.CameraSubject = game.Players.LocalPlayer.Character:FindFirstChild("Humanoid")
        end
        Library:Notify("相機已修復", 3)
    end
end)

ToolsGroup:AddButton("重新生成角色", function()
    local player = game.Players.LocalPlayer
    if player.Character then
        player.Character:BreakJoints()
        Library:Notify("角色正在重新生成", 3)
    end
end)

-- 系統功能
local SystemGroup = Tabs.Misc:AddRightGroupbox("系統功能", "cpu")

SystemGroup:AddToggle("AntiAFK", {
    Text = "防掛機",
    Default = true,
    Callback = function(value)
        if value then
            local VirtualUser = game:GetService("VirtualUser")
            game:GetService("Players").LocalPlayer.Idled:connect(function()
                VirtualUser:Button2Down(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
                wait(1)
                VirtualUser:Button2Up(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
            end)
            Library:Notify("防掛機已啟用", 3)
        else
            Library:Notify("防掛機已禁用", 3)
        end
    end
})

SystemGroup:AddButton("服務器信息", function()
    local players = game:GetService("Players")
    local lighting = game:GetService("Lighting")
    
    local info = string.format([[
服務器信息:
玩家人數: %d/%d
遊戲地點: %s
服務器FPS: %.1f
遊戲時間: %.1f
    ]],
    #players:GetPlayers(),
    players.MaxPlayers,
    game.PlaceId,
    1/workspace:GetRealPhysicsFPS(),
    lighting:GetMinutesAfterMidnight() / 60
    )
    
    Library:Notify(info, 10)
end)

SystemGroup:AddButton("複製遊戲鏈接", function()
    local gameLink = "https://www.roblox.com/games/" .. game.PlaceId
    if setclipboard then
        setclipboard(gameLink)
        Library:Notify("遊戲鏈接已複製到剪貼板", 3)
    else
        Library:Notify("無法複製鏈接", 3)
    end
end)

-- 性能優化組
local PerformanceGroup = Tabs.Misc:AddRightGroupbox("性能優化", "gauge")

PerformanceGroup:AddToggle("低圖形模式", {
    Text = "低圖形模式",
    Default = false,
    Callback = function(value)
        if value then
            settings().Rendering.QualityLevel = 1
            for _, effect in pairs(lighting:GetChildren()) do
                if effect:IsA("PostEffect") then
                    effect.Enabled = false
                end
            end
            Library:Notify("低圖形模式已啟用", 3)
        else
            settings().Rendering.QualityLevel = 10
            Library:Notify("低圖形模式已禁用", 3)
        end
    end
})

PerformanceGroup:AddToggle("禁用陰影", {
    Text = "禁用陰影",
    Default = false,
    Callback = function(value)
        if value then
            lighting.GlobalShadows = false
            Library:Notify("陰影已禁用", 3)
        else
            lighting.GlobalShadows = true
            Library:Notify("陰影已啟用", 3)
        end
    end
})

PerformanceGroup:AddButton("清理垃圾", function()
    collectgarbage("collect")
    Library:Notify("內存垃圾已清理", 3)
end)

PerformanceGroup:AddButton("優化遊戲", function()
    settings().Rendering.QualityLevel = 1
    lighting.GlobalShadows = false
    for _, effect in pairs(lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect.Enabled = false
        end
    end
    collectgarbage("collect")
    Library:Notify("遊戲性能已優化", 3)
end)

-- 重置所有設置功能
SystemGroup:AddButton("重置所有設定", function()
    -- 重置移動
    local character = game.Players.LocalPlayer.Character
    if character and character:FindFirstChild("Humanoid") then
        character.Humanoid.WalkSpeed = 16
        character.Humanoid.JumpPower = 50
    end
    
    -- 重置視覺效果
    lighting.ExposureCompensation = 0
    if lighting:FindFirstChild("ColorCorrection_Brightness") then
        lighting.ColorCorrection_Brightness.Brightness = 0
    end
    if lighting:FindFirstChild("ColorCorrection_Contrast") then
        lighting.ColorCorrection_Contrast.Contrast = 0
    end
    if lighting:FindFirstChild("ColorCorrection_Saturation") then
        lighting.ColorCorrection_Saturation.Saturation = 0
    end
    
    -- 重置戰鬥功能
    if killAuraEnabled then
        killAuraEnabled = false
    end
    
    if flingEnabled then
        flingEnabled = false
        if flingConnection then
            flingConnection:Disconnect()
            flingConnection = nil
        end
    end
    
    if antiFlingEnabled then
        antiFlingEnabled = false
        if antiFlingConnection then
            antiFlingConnection:Disconnect()
            antiFlingConnection = nil
        end
    end
    
    -- 重置無敵模式
    if godModeEnabled then
        godModeEnabled = false
        for _, connection in ipairs(godModeConnections) do
            if connection and typeof(connection) == "RBXScriptConnection" then
                connection:Disconnect()
            end
        end
        godModeConnections = {}
    end
    
    -- 重置自瞄
    if aimbotEnabled then
        aimbotEnabled = false
        if aimbotConnection then
            aimbotConnection:Disconnect()
            aimbotConnection = nil
        end
    end
    
    -- 重置碰撞箱
    if hitboxEnabled then
        hitboxEnabled = false
        restoreHitboxes()
    end
    
    -- 重置ESP
    if espEnabled then
        espEnabled = false
        for player, espObjects in pairs(espBoxes) do
            if espObjects.box then espObjects.box:Destroy() end
            if espObjects.billboard then espObjects.billboard:Destroy() end
        end
        espBoxes = {}
    end
    
    -- 重置靈魂出竅
    if outOfBodyEnabled then
        outOfBodyEnabled = false
        if soulPart then
            soulPart:Destroy()
            soulPart = nil
        end
        if soulBody then
            soulBody:Destroy()
            soulBody = nil
        end
        if soulControl then
            soulControl:Destroy()
            soulControl = nil
        end
        if originalCharacter then
            workspace.CurrentCamera.CameraSubject = originalCharacter.Humanoid
        end
    end
    
    -- 重置穿牆模式
    if noclipEnabled then
        noclipEnabled = false
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
    end
    
    -- 重置性能設置
    settings().Rendering.QualityLevel = 10
    lighting.GlobalShadows = true
    
    Library:Notify("所有設定已重置為默認值", 5)
end)

-- UI設置
local MenuGroup = Tabs.Settings:AddLeftGroupbox("菜單")

MenuGroup:AddToggle("KeybindMenuOpen", {
    Text = "打開按鍵綁定菜單",
    Default = false,
    Callback = function(value)
        Library.KeybindFrame.Visible = value
    end
})

MenuGroup:AddToggle("ShowCustomCursor", {
    Text = "自定義光標",
    Default = true,
    Callback = function(Value)
        Library.ShowCustomCursor = Value
    end
})

MenuGroup:AddDivider()

MenuGroup:AddLabel("菜單綁定"):AddKeyPicker("MenuKeybind", {
    Default = "RightShift",
    NoUI = false,
    Text = "菜單鍵綁定"
})

MenuGroup:AddButton("卸載UI", function()
    Library:Unload()
    Library:Notify("LOL漢化Hub 已卸載", 3)
end)

Library.ToggleKeybind = Options.MenuKeybind

-- 主題設置
local ThemeGroup = Tabs.Settings:AddRightGroupbox("主題")

ThemeGroup:AddDropdown("Theme", {
    Values = Library.Themes,
    Default = Library.Themes[1],
    Text = "主題選擇"
})

Options.Theme:OnChanged(function()
    Library:SetTheme(Options.Theme.Value)
end)

ThemeGroup:AddColorPicker("AccentColor", {
    Title = "主題顏色",
    Default = Color3.fromRGB(255, 0, 0)
})

Options.AccentColor:OnChanged(function()
    Library:ChangeThemeOption("AccentColor", Options.AccentColor.Value)
end)

-- 保存和加載設置
local SaveGroup = Tabs.Settings:AddLeftGroupbox("保存/加載")

SaveGroup:AddDropdown("ConfigList", {
    Values = SaveManager:GetConfigs(),
    Default = "",
    Text = "配置列表"
})

SaveGroup:AddButton("保存配置", function()
    local configName = Options.ConfigList.Value
    if configName and configName ~= "" then
        SaveManager:Save(configName)
        Library:Notify("配置已保存: " .. configName, 3)
    else
        Library:Notify("請輸入配置名稱", 3)
    end
end)

SaveGroup:AddButton("加載配置", function()
    local configName = Options.ConfigList.Value
    if configName and configName ~= "" then
        SaveManager:Load(configName)
        Library:Notify("配置已加載: " .. configName, 3)
    else
        Library:Notify("請選擇要加載的配置", 3)
    end
end)

SaveGroup:AddButton("刪除配置", function()
    local configName = Options.ConfigList.Value
    if configName and configName ~= "" then
        SaveManager:Delete(configName)
        Library:Notify("配置已刪除: " .. configName, 3)
    else
        Library:Notify("請選擇要刪除的配置", 3)
    end
end)

-- 初始化設定管理
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({"MenuKeybind"})
ThemeManager:ApplyToTab(Tabs.Settings)

-- 加載保存的設置
SaveManager:LoadAutoloadConfig()

-- 最終初始化
Library:Notify("LOL漢化Hub v2.1 加載完成！享受遊戲！", 5)

-- 卸載清理
Library:OnUnload(function()
    -- 清理所有連接
    if noclipConnection then noclipConnection:Disconnect() end
    if aimbotConnection then aimbotConnection:Disconnect() end
    if flingConnection then flingConnection:Disconnect() end
    if antiFlingConnection then antiFlingConnection:Disconnect() end
    
    -- 清理無敵模式連接
    for _, connection in ipairs(godModeConnections) do
        if connection and typeof(connection) == "RBXScriptConnection" then
            connection:Disconnect()
        end
    end
    
    -- 清理ESP
    for player, espObjects in pairs(espBoxes) do
        if espObjects.box then espObjects.box:Destroy() end
        if espObjects.billboard then espObjects.billboard:Destroy() end
    end
    
    -- 清理碰撞箱
    restoreHitboxes()
    
    -- 清理靈魂出竅
    if soulPart then soulPart:Destroy() end
    if soulBody then soulBody:Destroy() end
    if soulControl then soulControl:Destroy() end
    
    -- 清理主頁相關數據
    getgenv().ScriptStartTime = nil
    
    Library:Notify("LOL漢化Hub 已完全卸載", 3)
end)
