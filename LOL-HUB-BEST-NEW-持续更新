-- 繞過反作弊系統
local function BypassAntiCheat()
    -- 創建一個獨立的執行環境
    local SafeEnv = {}
    setmetatable(SafeEnv, {__index = getgenv()})
    
    -- 隱藏關鍵函數
    SafeEnv.hookfunction = nil
    SafeEnv.getconnections = nil
    SafeEnv.getrawmetatable = nil
    
    -- 替換可能被檢測的函數
    local originalNamecall
    originalNamecall = hookmetamethod(game, "__namecall", function(self, ...)
        local method = getnamecallmethod()
        if method == "Kick" or method == "kick" then
            return nil
        end
        return originalNamecall(self, ...)
    end)
    
    -- 防止檢測
    local originalIndex
    originalIndex = hookmetamethod(game, "__index", function(self, key)
        if key == "Parent" and self == game then
            return game
        end
        return originalIndex(self, key)
    end)
    
    return SafeEnv
end

-- 在安全環境中執行主腳本
local SafeEnvironment = BypassAntiCheat()

-- 將主腳本放在安全環境中執行
coroutine.wrap(function()
    -- 直接加載WindUI
    local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

    WindUI:Localization({
        Enabled = true,
        Prefix = "loc:",
        DefaultLanguage = "en",
        Translations = {
            ["en"] = {
                ["WELCOME"] = "歡迎使用LOL漢化hub",
                ["LIB_DESC"] = "正式版",
            }
        }
    })

    WindUI.TransparencyValue = 0.2
    WindUI:SetTheme("Dark")

    local function gradient(text, startColor, endColor)
        local result = ""
        for i = 1, #text do
            local t = (i - 1) / (#text - 1)
            local r = math.floor((startColor.R + (endColor.R - startColor.R) * t) * 255)
            local g = math.floor((startColor.G + (endColor.G - startColor.G) * t) * 255)
            local b = math.floor((startColor.B + (endColor.B - startColor.B) * t) * 255)
            result = result .. string.format('<font color="rgb(%d,%d,%d)">%s</font>', r, g, b, text:sub(i, i))
        end
        return result
    end

    WindUI:Popup({
        Title = gradient("LOL漢化hub", Color3.fromHex("#6A11CB"), Color3.fromHex("#2575FC")),
        Icon = "sparkles",
        Content = "歡迎使用LOL漢化hub",
        Buttons = {
            {
                Title = "開始使用",
                Icon = "arrow-right",
                Variant = "Primary",
                Callback = function() end
            }
        }
    })

    -- 調整窗口大小為移動端友好尺寸
    local Window = WindUI:CreateWindow({
        Title = "LOL漢化hub",
        Icon = "palette",
        Author = "歡迎使用LOL漢化hub",
        Folder = "WindUI_Example",
        Size = UDim2.fromOffset(600, 700), -- 調整為更適合移動端的尺寸
        Theme = "Dark",
        User = {
            Enabled = true,
            Anonymous = true,
            Callback = function()
                WindUI:Notify({
                    Title = "用戶資料",
                    Content = "用戶資料點擊！",
                    Duration = 3
                })
            end
        },
        SideBarWidth = 180, -- 稍微減小側邊欄寬度以適應移動端
        ScrollBarEnabled = true
    })

    Window:Tag({
        Title = "V1",
        Color = Color3.fromHex("#30ff6a")
    })
    Window:Tag({
        Title = "Release",
    })

    Window:CreateTopbarButton("theme-switcher", "moon", function()
        WindUI:SetTheme(WindUI:GetCurrentTheme() == "Dark" and "Light" or "Dark")
        WindUI:Notify({
            Title = "主題已更改",
            Content = "當前主題: "..WindUI:GetCurrentTheme(),
            Duration = 2
        })
    end, 990)

    -- 創建腳本標籤頁
    local ScriptsSection = Window:Section({ Title = "腳本", Opened = true })
    local ScriptsTab = ScriptsSection:Tab({ Title = "腳本", Icon = "code" })

    -- 添加Fartsaken按鈕
    ScriptsTab:Button({
        Title = "Fartsaken被遺棄",
        Icon = "play",
        Callback = function()
            -- 在安全環境中加載腳本
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/Fartsaken-LOL-QQ737561425"))()
            end)()
        end
    })

    -- 添加BronxWare 99 Nights漢化按鈕
    ScriptsTab:Button({
        Title = "BronxWare 99 Nights漢化",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/BronxWare99Nights-LOL"))()
            end)()
        end
    })

    -- 添加Doors XA Hub按鈕
    ScriptsTab:Button({
        Title = "Doors XA Hub",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/DoorsXAHubLOL"))()
            end)()
        end
    })

    -- 添加住宅大屠殺按鈕
    ScriptsTab:Button({
        Title = "住宅大屠殺",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/LOLHANHUA"))()
            end)()
        end
    })

    -- 添加Red Hub(死亡之死LOL漢化)按鈕
    ScriptsTab:Button({
        Title = "Red Hub(死亡之死LOL漢化)",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/Death%20is%20die"))()
            end)()
        end
    })

    -- 添加UNDETECTEDWARE犯罪(半漢化)按鈕
    ScriptsTab:Button({
        Title = "UNDETECTEDWARE犯罪(半漢化)",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/UNDETECTEDWARE-LOLHAZNHUA"))()
            end)()
        end
    })

    -- 創建雜項標籤頁
    local MiscSection = Window:Section({ Title = "雜項", Opened = true })
    local MiscTab = MiscSection:Tab({ Title = "基礎功能", Icon = "settings" })

    -- 添加說明
    MiscTab:Paragraph({
        Title = "基礎功能設置",
        Desc = "調整玩家基本屬性和實用功能",
        Image = "user",
        ImageSize = 20,
        Color = "White",
    })

    MiscTab:Divider()

    -- 修改速度功能
    local speedValue = 16
    local speedSlider = MiscTab:Slider({
        Title = "移動速度",
        Desc = "調整玩家移動速度",
        Value = { Min = 0, Max = 100, Default = 16 },
        Callback = function(value)
            speedValue = value
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = value
            end
        end
    })

    -- 修改跳躍高度功能
    local jumpValue = 50
    local jumpSlider = MiscTab:Slider({
        Title = "跳躍高度",
        Desc = "調整玩家跳躍高度",
        Value = { Min = 0, Max = 200, Default = 50 },
        Callback = function(value)
            jumpValue = value
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.JumpPower = value
            end
        end
    })

    -- 修改生命值功能
    local healthValue = 100
    MiscTab:Input({
        Title = "生命值",
        Desc = "設置玩家生命值",
        Value = "100",
        Callback = function(value)
            healthValue = tonumber(value) or 100
        end
    })

    MiscTab:Button({
        Title = "應用生命值",
        Icon = "heart",
        Callback = function()
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.Health = healthValue
                WindUI:Notify({
                    Title = "生命值已設置",
                    Content = "生命值設置為: " .. healthValue,
                    Icon = "check",
                    Duration = 3
                })
            else
                WindUI:Notify({
                    Title = "錯誤",
                    Content = "找不到玩家角色或Humanoid",
                    Icon = "x",
                    Duration = 3
                })
            end
        end
    })

    MiscTab:Divider()

    -- 添加飛行按鈕
    MiscTab:Button({
        Title = "飛行",
        Icon = "feather",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E6%B1%89%E5%8C%96%E9%A3%9E%E8%A1%8C"))()
            end)()
            WindUI:Notify({
                Title = "飛行腳本已加載",
                Content = "飛行功能已啟用",
                Icon = "feather",
                Duration = 3
            })
        end
    })

    -- 添加甩人按鈕
    MiscTab:Button({
        Title = "甩人",
        Icon = "wind",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E7%94%A9%E4%BA%BA%E6%B1%89%E5%8C%96"))()
            end)()
            WindUI:Notify({
                Title = "甩人腳本已加載",
                Content = "甩人功能已啟用",
                Icon = "wind",
                Duration = 3
            })
        end
    })

    -- 添加時間回溯按鈕
    MiscTab:Button({
        Title = "時間回溯",
        Icon = "rewind",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E5%9B%9E%E6%BA%AF%E6%97%B6%E9%97%B4LOL"))()
            end)()
            WindUI:Notify({
                Title = "時間回溯腳本已加載",
                Content = "時間回溯功能已啟用",
                Icon = "rewind",
                Duration = 3
            })
        end
    })

    -- 添加甩飛按鈕
    MiscTab:Button({
        Title = "甩飛",
        Icon = "zap",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/0Ben1/fe./main/Fling%20GUI"))()
            end)()
            WindUI:Notify({
                Title = "甩飛腳本已加載",
                Content = "甩飛功能已啟用",
                Icon = "zap",
                Duration = 3
            })
        end
    })

    -- 添加無敵少俠飛行r15按鈕
    MiscTab:Button({
        Title = "無敵少俠飛行r15",
        Icon = "shield",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/invincible-FLY"))()
            end)()
            WindUI:Notify({
                Title = "無敵少俠飛行腳本已加載",
                Content = "無敵少俠飛行功能已啟用",
                Icon = "shield",
                Duration = 3
            })
        end
    })

    -- 添加點擊傳送按鈕
    MiscTab:Button({
        Title = "點擊傳送",
        Icon = "navigation",
        Callback = function()
            coroutine.wrap(function()
                mouse = game.Players.LocalPlayer:GetMouse()
                tool = Instance.new("Tool")
                tool.RequiresHandle = false
                tool.Name = "LOL點擊傳送"
                tool.Activated:connect(function()
                    local pos = mouse.Hit+Vector3.new(0,2.5,0)
                    pos = CFrame.new(pos.X,pos.Y,pos.Z)
                    game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = pos
                end)
                tool.Parent = game.Players.LocalPlayer.Backpack
            end)()
            WindUI:Notify({
                Title = "點擊傳送工具已添加",
                Content = "請查看背包中的LOL點擊傳送工具",
                Icon = "navigation",
                Duration = 3
            })
        end
    })

    -- 添加透視按鈕
    local espEnabled = false
    local espBoxes = {}
    
    MiscTab:Button({
        Title = "透視",
        Icon = "eye",
        Callback = function()
            espEnabled = not espEnabled
            
            if espEnabled then
                -- 啟用透視
                WindUI:Notify({
                    Title = "透視功能已啟用",
                    Content = "正在顯示玩家彩色3D框",
                    Icon = "eye",
                    Duration = 3
                })
                
                -- 創建ESP功能
                local function createESP(player)
                    if player == game.Players.LocalPlayer then return end
                    
                    local character = player.Character
                    if not character then return end
                    
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if not humanoidRootPart then return end
                    
                    -- 生成隨機顏色
                    local function getRandomColor()
                        local colors = {
                            Color3.fromRGB(255, 0, 0),     -- 紅色
                            Color3.fromRGB(0, 255, 0),     -- 綠色
                            Color3.fromRGB(0, 0, 255),     -- 藍色
                            Color3.fromRGB(255, 255, 0),   -- 黃色
                            Color3.fromRGB(255, 0, 255),   -- 粉色
                            Color3.fromRGB(0, 255, 255),   -- 青色
                            Color3.fromRGB(255, 165, 0),   -- 橙色
                            Color3.fromRGB(128, 0, 128),   -- 紫色
                            Color3.fromRGB(0, 128, 0),     -- 深綠色
                            Color3.fromRGB(255, 192, 203)  -- 淺粉色
                        }
                        return colors[math.random(1, #colors)]
                    end
                    
                    local playerColor = getRandomColor()
                    
                    -- 創建彩色方框
                    local box = Instance.new("BoxHandleAdornment")
                    box.Name = "ESP_" .. player.Name
                    box.Adornee = humanoidRootPart
                    box.AlwaysOnTop = true
                    box.ZIndex = 10
                    box.Size = Vector3.new(4, 6, 2)
                    box.Color3 = playerColor
                    box.Transparency = 0.2
                    box.Parent = humanoidRootPart
                    
                    -- 創建名稱標籤（使用相同顏色）
                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = "ESP_Name_" .. player.Name
                    billboard.Adornee = humanoidRootPart
                    billboard.Size = UDim2.new(0, 200, 0, 50)
                    billboard.StudsOffset = Vector3.new(0, 3.5, 0)
                    billboard.AlwaysOnTop = true
                    
                    local nameLabel = Instance.new("TextLabel")
                    nameLabel.Size = UDim2.new(1, 0, 1, 0)
                    nameLabel.BackgroundTransparency = 1
                    nameLabel.Text = player.Name
                    nameLabel.TextColor3 = playerColor
                    nameLabel.TextStrokeTransparency = 0
                    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                    nameLabel.TextSize = 14
                    nameLabel.Font = Enum.Font.GothamBold
                    nameLabel.Parent = billboard
                    
                    billboard.Parent = humanoidRootPart
                    
                    -- 保存ESP對象
                    espBoxes[player] = {box = box, billboard = billboard}
                end
                
                -- 為所有現有玩家創建ESP
                for _, player in ipairs(game.Players:GetPlayers()) do
                    createESP(player)
                end
                
                -- 監聽新玩家加入
                game.Players.PlayerAdded:Connect(function(player)
                    player.CharacterAdded:Connect(function(character)
                        wait(1) -- 等待角色加載完成
                        createESP(player)
                    end)
                end)
                
                -- 監聽玩家離開
                game.Players.PlayerRemoving:Connect(function(player)
                    if espBoxes[player] then
                        if espBoxes[player].box then
                            espBoxes[player].box:Destroy()
                        end
                        if espBoxes[player].billboard then
                            espBoxes[player].billboard:Destroy()
                        end
                        espBoxes[player] = nil
                    end
                end)
                
                -- 監聽角色變化
                for _, player in ipairs(game.Players:GetPlayers()) do
                    player.CharacterAdded:Connect(function(character)
                        wait(1) -- 等待角色加載完成
                        createESP(player)
                    end)
                end
            else
                -- 禁用透視
                WindUI:Notify({
                    Title = "透視功能已禁用",
                    Content = "已移除所有玩家彩色3D框",
                    Icon = "eye-off",
                    Duration = 3
                })
                
                -- 移除所有ESP對象
                for player, espObjects in pairs(espBoxes) do
                    if espObjects.box then
                        espObjects.box:Destroy()
                    end
                    if espObjects.billboard then
                        espObjects.billboard:Destroy()
                    end
                end
                espBoxes = {}
            end
        end
    })

    MiscTab:Divider()

    -- 重置按鈕
    MiscTab:Button({
        Title = "重置所有設置",
        Icon = "refresh-cw",
        Variant = "Secondary",
        Callback = function()
            -- 重置速度
            speedSlider:Set(16)
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = 16
            end
            
            -- 重置跳躍高度
            jumpSlider:Set(50)
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.JumpPower = 50
            end
            
            WindUI:Notify({
                Title = "重置完成",
                Content = "所有設置已重置為默認值",
                Icon = "check",
                Duration = 3
            })
        end
    })

    Window:OnClose(function()
        print("Window closed")
    end)

    Window:OnDestroy(function()
        print("Window destroyed")
    end)
end)()
