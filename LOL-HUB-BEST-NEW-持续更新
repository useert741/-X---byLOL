-- 繞過反作弊系統
local function BypassAntiCheat()
    -- 創建一個獨立的執行環境
    local SafeEnv = {}
    setmetatable(SafeEnv, {__index = getgenv()})
    
    -- 隱藏關鍵函數
    SafeEnv.hookfunction = nil
    SafeEnv.getconnections = nil
    SafeEnv.getrawmetatable = nil
    
    -- 替換可能被檢測的函數
    local originalNamecall
    originalNamecall = hookmetamethod(game, "__namecall", function(self, ...)
        local method = getnamecallmethod()
        if method == "Kick" or method == "kick" then
            return nil
        end
        return originalNamecall(self, ...)
    end)
    
    -- 防止檢測
    local originalIndex
    originalIndex = hookmetamethod(game, "__index", function(self, key)
        if key == "Parent" and self == game then
            return game
        end
        return originalIndex(self, key)
    end)
    
    return SafeEnv
end

-- 在安全環境中執行主腳本
local SafeEnvironment = BypassAntiCheat()

-- 將主腳本放在安全環境中執行
coroutine.wrap(function()
    -- 創建右下角歡迎提示
    local function CreateWelcomeNotification()
        local screenGui = Instance.new("ScreenGui")
        screenGui.Name = "WelcomeNotification"
        screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        screenGui.Parent = game:GetService("CoreGui")
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 300, 0, 80)
        frame.Position = UDim2.new(1, -320, 1, -100) -- 右下角位置
        frame.AnchorPoint = Vector2.new(1, 1)
        frame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        frame.BackgroundTransparency = 0.2
        frame.BorderSizePixel = 0
        frame.Parent = screenGui
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = frame
        
        local stroke = Instance.new("UIStroke")
        stroke.Color = Color3.fromHex("#6A11CB")
        stroke.Thickness = 2
        stroke.Parent = frame
        
        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromHex("#6A11CB")),
            ColorSequenceKeypoint.new(1, Color3.fromHex("#2575FC"))
        })
        gradient.Rotation = 45
        stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        stroke.LineJoinMode = Enum.LineJoinMode.Round
        stroke.Transparency = NumberSequence.new(0)
        
        local icon = Instance.new("ImageLabel")
        icon.Size = UDim2.new(0, 40, 0, 40)
        icon.Position = UDim2.new(0, 15, 0.5, -20)
        icon.AnchorPoint = Vector2.new(0, 0.5)
        icon.BackgroundTransparency = 1
        icon.Image = "rbxassetid://6031091003" -- 星星图标
        icon.ImageColor3 = Color3.fromHex("#2575FC")
        icon.Parent = frame
        
        local title = Instance.new("TextLabel")
        title.Size = UDim2.new(1, -70, 0, 30)
        title.Position = UDim2.new(0, 70, 0, 15)
        title.BackgroundTransparency = 1
        title.Text = "歡迎使用LOL漢化hub"
        title.TextColor3 = Color3.fromRGB(255, 255, 255)
        title.TextSize = 18
        title.Font = Enum.Font.GothamBold
        title.TextXAlignment = Enum.TextXAlignment.Left
        title.Parent = frame
        
        local desc = Instance.new("TextLabel")
        desc.Size = UDim2.new(1, -70, 0, 20)
        desc.Position = UDim2.new(0, 70, 0, 45)
        desc.BackgroundTransparency = 1
        desc.Text = "V2"
        desc.TextColor3 = Color3.fromRGB(200, 200, 200)
        desc.TextSize = 14
        desc.Font = Enum.Font.Gotham
        desc.TextXAlignment = Enum.TextXAlignment.Left
        desc.Parent = frame
        
        -- 添加淡入动画
        frame.BackgroundTransparency = 1
        title.TextTransparency = 1
        desc.TextTransparency = 1
        icon.ImageTransparency = 1
        
        local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tweenService = game:GetService("TweenService")
        
        local tween1 = tweenService:Create(frame, tweenInfo, {BackgroundTransparency = 0.2})
        local tween2 = tweenService:Create(title, tweenInfo, {TextTransparency = 0})
        local tween3 = tweenService:Create(desc, tweenInfo, {TextTransparency = 0})
        local tween4 = tweenService:Create(icon, tweenInfo, {ImageTransparency = 0})
        
        tween1:Play()
        tween2:Play()
        tween3:Play()
        tween4:Play()
        
        -- 5秒后淡出并删除
        wait(5)
        
        local tweenOut = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
        local tween5 = tweenService:Create(frame, tweenOut, {BackgroundTransparency = 1})
        local tween6 = tweenService:Create(title, tweenOut, {TextTransparency = 1})
        local tween7 = tweenService:Create(desc, tweenOut, {TextTransparency = 1})
        local tween8 = tweenService:Create(icon, tweenOut, {ImageTransparency = 1})
        
        tween5:Play()
        tween6:Play()
        tween7:Play()
        tween8:Play()
        
        tween5.Completed:Wait()
        screenGui:Destroy()
    end

    -- 立即顯示歡迎提示
    CreateWelcomeNotification()

    -- 直接加載WindUI
    local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

    WindUI:Localization({
        Enabled = true,
        Prefix = "loc:",
        DefaultLanguage = "en",
        Translations = {
            ["en"] = {
                ["WELCOME"] = "歡迎使用LOL漢化hub",
                ["LIB_DESC"] = "正式版",
            }
        }
    })

    WindUI.TransparencyValue = 0.2
    WindUI:SetTheme("Dark")

    local function gradient(text, startColor, endColor)
        local result = ""
        for i = 1, #text do
            local t = (i - 1) / (#text - 1)
            local r = math.floor((startColor.R + (endColor.R - startColor.R) * t) * 255)
            local g = math.floor((startColor.G + (endColor.G - startColor.G) * t) * 255)
            local b = math.floor((startColor.B + (endColor.B - startColor.B) * t) * 255)
            result = result .. string.format('<font color="rgb(%d,%d,%d)">%s</font>', r, g, b, text:sub(i, i))
        end
        return result
    end

    WindUI:Popup({
        Title = gradient("LOL漢化hub", Color3.fromHex("#6A11CB"), Color3.fromHex("#2575FC")),
        Icon = "sparkles",
        Content = "歡迎使用LOL漢化hub",
        Buttons = {
            {
                Title = "開始使用",
                Icon = "arrow-right",
                Variant = "Primary",
                Callback = function() end
            }
        }
    })

    -- 調整窗口大小
    local Window = WindUI:CreateWindow({
        Title = "LOL漢化hub",
        Icon = "palette",
        Author = "歡迎使用LOL漢化hub",
        Folder = "WindUI_Example",
        Size = UDim2.fromOffset(600, 700),
        Theme = "Dark",
        User = {
            Enabled = true,
            Anonymous = true,
            Callback = function()
                WindUI:Notify({
                    Title = "用戶資料",
                    Content = "用戶資料點擊！",
                    Duration = 3
                })
            end
        },
        SideBarWidth = 180,
        ScrollBarEnabled = true
    })

    Window:Tag({
        Title = "V2",
        Color = Color3.fromHex("#30ff6a")
    })
    Window:Tag({
        Title = "Release",
    })

    Window:CreateTopbarButton("theme-switcher", "moon", function()
        WindUI:SetTheme(WindUI:GetCurrentTheme() == "Dark" and "Light" or "Dark")
        WindUI:Notify({
            Title = "主題已更改",
            Content = "當前主題: "..WindUI:GetCurrentTheme(),
            Duration = 2
        })
    end, 990)

    -- 創建腳本標籤頁
    local ScriptsSection = Window:Section({ Title = "腳本", Opened = true })
    local ScriptsTab = ScriptsSection:Tab({ Title = "腳本", Icon = "code" })

    -- 添加Fartsaken按鈕
    ScriptsTab:Button({
        Title = "Fartsaken被遺棄",
        Icon = "play",
        Callback = function()
            -- 在安全環境中加載腳本
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/Fartsaken-LOL-QQ737561425"))()
            end)()
        end
    })

    -- 添加BronxWare 99 Nights漢化按鈕
    ScriptsTab:Button({
        Title = "BronxWare 99 Nights漢化",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/BronxWare99Nights-LOL"))()
            end)()
        end
    })

    -- 添加Doors XA Hub按鈕
    ScriptsTab:Button({
        Title = "Doors XA Hub",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/DoorsXAHubLOL"))()
            end)()
        end
    })

    -- 添加住宅大屠殺按鈕
    ScriptsTab:Button({
        Title = "住宅大屠殺",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/LOLHANHUA"))()
            end)()
        end
    })

    -- 添加Red Hub(死亡之死LOL漢化)按鈕
    ScriptsTab:Button({
        Title = "Red Hub(死亡之死LOL漢化)",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/Death%20is%20die"))()
            end)()
        end
    })

    -- 添加UNDETECTEDWARE犯罪(半漢化)按鈕
    ScriptsTab:Button({
        Title = "UNDETECTEDWARE犯罪(半漢化)",
        Icon = "play",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/UNDETECTEDWARE-LOLHAZNHUA"))()
            end)()
        end
    })

    -- 創建雜項標籤頁
    local MiscSection = Window:Section({ Title = "雜項", Opened = true })
    local MiscTab = MiscSection:Tab({ Title = "基礎功能", Icon = "settings" })

    -- 添加說明
    MiscTab:Paragraph({
        Title = "基礎功能設置",
        Desc = "調整玩家基本屬性和實用功能",
        Image = "user",
        ImageSize = 20,
        Color = "White",
    })

    MiscTab:Divider()

    -- 修改速度功能
    local speedValue = 16
    local speedSlider = MiscTab:Slider({
        Title = "移動速度",
        Desc = "調整玩家移動速度",
        Value = { Min = 0, Max = 100, Default = 16 },
        Callback = function(value)
            speedValue = value
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = value
            end
        end
    })

    -- 修改跳躍高度功能
    local jumpValue = 50
    local jumpSlider = MiscTab:Slider({
        Title = "跳躍高度",
        Desc = "調整玩家跳躍高度",
        Value = { Min = 0, Max = 200, Default = 50 },
        Callback = function(value)
            jumpValue = value
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.JumpPower = value
            end
        end
    })

    -- 修改生命值功能
    local healthValue = 100
    MiscTab:Input({
        Title = "生命值",
        Desc = "設置玩家生命值",
        Value = "100",
        Callback = function(value)
            healthValue = tonumber(value) or 100
        end
    })

    MiscTab:Button({
        Title = "應用生命值",
        Icon = "heart",
        Callback = function()
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.Health = healthValue
                WindUI:Notify({
                    Title = "生命值已設置",
                    Content = "生命值設置為: " .. healthValue,
                    Icon = "check",
                    Duration = 3
                })
            else
                WindUI:Notify({
                    Title = "錯誤",
                    Content = "找不到玩家角色或Humanoid",
                    Icon = "x",
                    Duration = 3
                })
            end
        end
    })

    MiscTab:Divider()

    -- 添加飛行按鈕
    MiscTab:Button({
        Title = "飛行",
        Icon = "feather",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E6%B1%89%E5%8C%96%E9%A3%9E%E8%A1%8C"))()
            end)()
            WindUI:Notify({
                Title = "飛行腳本已加載",
                Content = "飛行功能已啟用",
                Icon = "feather",
                Duration = 3
            })
        end
    })

    -- 添加甩人按鈕
    MiscTab:Button({
        Title = "甩人",
        Icon = "wind",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E7%94%A9%E4%BA%BA%E6%B1%89%E5%8C%96"))()
            end)()
            WindUI:Notify({
                Title = "甩人腳本已加載",
                Content = "甩人功能已啟用",
                Icon = "wind",
                Duration = 3
            })
        end
    })

    -- 添加時間回溯按鈕
    MiscTab:Button({
        Title = "時間回溯",
        Icon = "rewind",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/%E5%9B%9E%E6%BA%AF%E6%97%B6%E9%97%B4LOL"))()
            end)()
            WindUI:Notify({
                Title = "時間回溯腳本已加載",
                Content = "時間回溯功能已啟用",
                Icon = "rewind",
                Duration = 3
            })
        end
    })

    -- 添加甩飛按鈕
    MiscTab:Button({
        Title = "甩飛",
        Icon = "zap",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/0Ben1/fe./main/Fling%20GUI"))()
            end)()
            WindUI:Notify({
                Title = "甩飛腳本已加載",
                Content = "甩飛功能已啟用",
                Icon = "zap",
                Duration = 3
            })
        end
    })

    -- 添加無敵少俠飛行r15按鈕
    MiscTab:Button({
        Title = "無敵少俠飛行r15",
        Icon = "shield",
        Callback = function()
            coroutine.wrap(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useert741/-X---byLOL/refs/heads/main/invincible-FLY"))()
            end)()
            WindUI:Notify({
                Title = "無敵少俠飛行腳本已加載",
                Content = "無敵少俠飛行功能已啟用",
                Icon = "shield",
                Duration = 3
            })
        end
    })

    -- 添加點擊傳送按鈕
    MiscTab:Button({
        Title = "點擊傳送",
        Icon = "navigation",
        Callback = function()
            coroutine.wrap(function()
                mouse = game.Players.LocalPlayer:GetMouse()
                tool = Instance.new("Tool")
                tool.RequiresHandle = false
                tool.Name = "LOL點擊傳送"
                tool.Activated:connect(function()
                    local pos = mouse.Hit+Vector3.new(0,2.5,0)
                    pos = CFrame.new(pos.X,pos.Y,pos.Z)
                    game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = pos
                end)
                tool.Parent = game.Players.LocalPlayer.Backpack
            end)()
            WindUI:Notify({
                Title = "點擊傳送工具已添加",
                Content = "請查看背包中的LOL點擊傳送工具",
                Icon = "navigation",
                Duration = 3
            })
        end
    })

    -- 添加穿墙功能
    local noclipEnabled = false
    local noclipConnection = nil
    
    MiscTab:Button({
        Title = "穿墙",
        Icon = "git-merge",
        Callback = function()
            noclipEnabled = not noclipEnabled
            
            if noclipEnabled then
                WindUI:Notify({
                    Title = "穿墙已启用",
                    Content = "现在可以穿过物体",
                    Icon = "git-merge",
                    Duration = 3
                })
                
                local player = game.Players.LocalPlayer
                local character = player.Character
                
                -- 穿墙功能主循环
                noclipConnection = game:GetService("RunService").Stepped:Connect(function()
                    if not noclipEnabled then return end
                    
                    local currentCharacter = player.Character
                    if not currentCharacter then return end
                    
                    -- 禁用角色所有部件的碰撞
                    for _, part in pairs(currentCharacter:GetDescendants()) do
                        if part:IsA("BasePart") and part.CanCollide then
                            part.CanCollide = false
                        end
                    end
                end)
                
                -- 监听角色变化
                player.CharacterAdded:Connect(function(newChar)
                    character = newChar
                    wait(1) -- 等待角色加载完成
                    
                    -- 为新角色应用穿墙
                    if noclipEnabled then
                        for _, part in pairs(character:GetDescendants()) do
                            if part:IsA("BasePart") and part.CanCollide then
                                part.CanCollide = false
                            end
                        end
                    end
                end)
                
            else
                -- 禁用穿墙
                if noclipConnection then
                    noclipConnection:Disconnect()
                    noclipConnection = nil
                end
                
                -- 恢复角色碰撞
                local character = game.Players.LocalPlayer.Character
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") and not part.CanCollide then
                            part.CanCollide = true
                        end
                    end
                end
                
                WindUI:Notify({
                    Title = "穿墙已禁用",
                    Content = "现在无法穿过物体",
                    Icon = "git-merge",
                    Duration = 3
                })
            end
        end
    })

    -- 添加透視按鈕
    local espEnabled = false
    local espBoxes = {}
    
    MiscTab:Button({
        Title = "透視",
        Icon = "eye",
        Callback = function()
            espEnabled = not espEnabled
            
            if espEnabled then
                -- 啟用透視
                WindUI:Notify({
                    Title = "透視功能已啟用",
                    Content = "正在顯示玩家紅色3D框",
                    Icon = "eye",
                    Duration = 3
                })
                
                -- 創建ESP功能
                local function createESP(player)
                    if player == game.Players.LocalPlayer then return end
                    
                    local character = player.Character
                    if not character then return end
                    
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if not humanoidRootPart then return end
                    
                    -- 固定使用紅色
                    local playerColor = Color3.fromRGB(255, 0, 0)
                    
                    -- 創建紅色方框
                    local box = Instance.new("BoxHandleAdornment")
                    box.Name = "ESP_" .. player.Name
                    box.Adornee = humanoidRootPart
                    box.AlwaysOnTop = true
                    box.ZIndex = 10
                    box.Size = Vector3.new(4, 6, 2)
                    box.Color3 = playerColor
                    box.Transparency = 0.2
                    box.Parent = humanoidRootPart
                    
                    -- 創建名稱標籤（使用紅色）
                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = "ESP_Name_" .. player.Name
                    billboard.Adornee = humanoidRootPart
                    billboard.Size = UDim2.new(0, 200, 0, 50)
                    billboard.StudsOffset = Vector3.new(0, 3.5, 0)
                    billboard.AlwaysOnTop = true
                    
                    local nameLabel = Instance.new("TextLabel")
                    nameLabel.Size = UDim2.new(1, 0, 1, 0)
                    nameLabel.BackgroundTransparency = 1
                    nameLabel.Text = player.Name
                    nameLabel.TextColor3 = playerColor
                    nameLabel.TextStrokeTransparency = 0
                    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                    nameLabel.TextSize = 14
                    nameLabel.Font = Enum.Font.GothamBold
                    nameLabel.Parent = billboard
                    
                    billboard.Parent = humanoidRootPart
                    
                    -- 保存ESP對象
                    espBoxes[player] = {box = box, billboard = billboard}
                end
                
                -- 為所有現有玩家創建ESP
                for _, player in ipairs(game.Players:GetPlayers()) do
                    createESP(player)
                end
                
                -- 監聽新玩家加入
                game.Players.PlayerAdded:Connect(function(player)
                    player.CharacterAdded:Connect(function(character)
                        wait(1) -- 等待角色加載完成
                        createESP(player)
                    end)
                end)
                
                -- 監聽玩家離開
                game.Players.PlayerRemoving:Connect(function(player)
                    if espBoxes[player] then
                        if espBoxes[player].box then
                            espBoxes[player].box:Destroy()
                        end
                        if espBoxes[player].billboard then
                            espBoxes[player].billboard:Destroy()
                        end
                        espBoxes[player] = nil
                    end
                end)
                
                -- 監聽角色變化
                for _, player in ipairs(game.Players:GetPlayers()) do
                    player.CharacterAdded:Connect(function(character)
                        wait(1) -- 等待角色加載完成
                        createESP(player)
                    end)
                end
            else
                -- 禁用透視
                WindUI:Notify({
                    Title = "透視功能已禁用",
                    Content = "已移除所有玩家紅色3D框",
                    Icon = "eye-off",
                    Duration = 3
                })
                
                -- 移除所有ESP對象
                for player, espObjects in pairs(espBoxes) do
                    if espObjects.box then
                        espObjects.box:Destroy()
                    end
                    if espObjects.billboard then
                        espObjects.billboard:Destroy()
                    end
                end
                espBoxes = {}
            end
        end
    })

    -- 添加殺戮光環按鈕和範圍設置
    local killAuraEnabled = false
    local killAuraRange = 20
    
    -- 殺戮光環範圍滑塊
    local killAuraSlider = MiscTab:Slider({
        Title = "殺戮光環範圍",
        Desc = "設置自動攻擊範圍",
        Value = { Min = 5, Max = 50, Default = 20 },
        Callback = function(value)
            killAuraRange = value
        end
    })

    -- 殺戮光環按鈕
    MiscTab:Button({
        Title = "殺戮光環",
        Icon = "sword",
        Callback = function()
            killAuraEnabled = not killAuraEnabled
            
            if killAuraEnabled then
                WindUI:Notify({
                    Title = "殺戮光環已啟用",
                    Content = "自動攻擊範圍內的玩家，範圍: " .. killAuraRange,
                    Icon = "sword",
                    Duration = 3
                })
                
                -- 殺戮光環主循環
                coroutine.wrap(function()
                    while killAuraEnabled do
                        wait(0.1) -- 每0.1秒檢測一次
                        
                        local localPlayer = game.Players.LocalPlayer
                        local localCharacter = localPlayer.Character
                        
                        if localCharacter and localCharacter:FindFirstChild("HumanoidRootPart") then
                            local localRoot = localCharacter.HumanoidRootPart
                            
                            -- 檢測範圍內的所有玩家
                            for _, player in ipairs(game.Players:GetPlayers()) do
                                if player ~= localPlayer then
                                    local character = player.Character
                                    if character and character:FindFirstChild("HumanoidRootPart") then
                                        local targetRoot = character.HumanoidRootPart
                                        local distance = (localRoot.Position - targetRoot.Position).Magnitude
                                        
                                        -- 如果目標在範圍內，進行攻擊
                                        if distance <= killAuraRange then
                                            -- 這裡可以添加具體的攻擊邏輯
                                            -- 例如：使用工具攻擊、發射射線等
                                            localRoot.CFrame = targetRoot.CFrame
                                        end
                                    end
                                end
                            end
                        end
                    end
                end)()
            else
                WindUI:Notify({
                    Title = "殺戮光環已禁用",
                    Content = "已停止自動攻擊",
                    Icon = "sword",
                    Duration = 3
                })
            end
        end
    })

    -- 添加自動攻擊按鈕
    local autoAttackEnabled = false
    local autoAttackRange = 15
    
    -- 自動攻擊範圍滑塊
    local autoAttackSlider = MiscTab:Slider({
        Title = "自動攻擊範圍",
        Desc = "設置自動攻擊檢測範圍",
        Value = { Min = 5, Max = 30, Default = 15 },
        Callback = function(value)
            autoAttackRange = value
        end
    })

    -- 自動攻擊按鈕
    MiscTab:Button({
        Title = "自動攻擊",
        Icon = "target",
        Callback = function()
            autoAttackEnabled = not autoAttackEnabled
            
            if autoAttackEnabled then
                WindUI:Notify({
                    Title = "自動攻擊已啟用",
                    Content = "自動攻擊範圍內的敵人，範圍: " .. autoAttackRange,
                    Icon = "target",
                    Duration = 3
                })
                
                -- 自動攻擊主循環
                coroutine.wrap(function()
                    while autoAttackEnabled do
                        wait(0.2) -- 每0.2秒檢測一次
                        
                        local localPlayer = game.Players.LocalPlayer
                        local localCharacter = localPlayer.Character
                        
                        if localCharacter and localCharacter:FindFirstChild("HumanoidRootPart") then
                            local localRoot = localCharacter.HumanoidRootPart
                            
                            -- 尋找最近的敵人
                            local closestTarget = nil
                            local closestDistance = autoAttackRange
                            
                            for _, player in ipairs(game.Players:GetPlayers()) do
                                if player ~= localPlayer then
                                    local character = player.Character
                                    if character and character:FindFirstChild("HumanoidRootPart") and character:FindFirstChild("Humanoid") then
                                        local targetRoot = character.HumanoidRootPart
                                        local humanoid = character.Humanoid
                                        
                                        -- 檢查目標是否存活
                                        if humanoid.Health > 0 then
                                            local distance = (localRoot.Position - targetRoot.Position).Magnitude
                                            
                                            if distance < closestDistance then
                                                closestDistance = distance
                                                closestTarget = character
                                            end
                                        end
                                    end
                                end
                            end
                            
                            -- 如果有目標在範圍內，進行攻擊
                            if closestTarget then
                                local targetRoot = closestTarget.HumanoidRootPart
                                
                                -- 面向目標
                                localRoot.CFrame = CFrame.new(localRoot.Position, targetRoot.Position)
                                
                                -- 模擬攻擊動作（這裡可以根據遊戲具體機制調整）
                                if localCharacter:FindFirstChildOfClass("Tool") then
                                    local tool = localCharacter:FindFirstChildOfClass("Tool")
                                    -- 激活工具（如果有的話）
                                    if tool:FindFirstChild("Handle") then
                                        -- 這裡可以添加具體的攻擊邏輯
                                    end
                                end
                            end
                        end
                    end
                end)()
            else
                WindUI:Notify({
                    Title = "自動攻擊已禁用",
                    Content = "已停止自動攻擊",
                    Icon = "target",
                    Duration = 3
                })
            end
        end
    })

    -- 添加無限傷害武器按鈕
    MiscTab:Button({
        Title = "無限傷害武器",
        Icon = "zap",
        Callback = function()
            coroutine.wrap(function()
                local player = game.Players.LocalPlayer
                
                -- 創建無限傷害武器
                local weapon = Instance.new("Tool")
                weapon.Name = "LOL無限武器"
                weapon.RequiresHandle = false
                
                -- 創建武器手柄（視覺效果）
                local handle = Instance.new("Part")
                handle.Name = "Handle"
                handle.Size = Vector3.new(1, 1, 4)
                handle.BrickColor = BrickColor.new("Bright red")
                handle.Material = Enum.Material.Neon
                handle.Parent = weapon
                
                -- 創建武器特效
                local pointLight = Instance.new("PointLight")
                pointLight.Brightness = 5
                pointLight.Range = 10
                pointLight.Color = Color3.fromRGB(255, 0, 0)
                pointLight.Parent = handle
                
                -- 添加揮動動畫
                local swingAnimation = Instance.new("Animation")
                swingAnimation.AnimationId = "rbxassetid://188632011" -- 標準揮動動畫
                
                -- 武器激活時的無限傷害功能
                weapon.Activated:Connect(function()
                    local character = player.Character
                    if not character then return end
                    
                    local humanoid = character:FindFirstChild("Humanoid")
                    if not humanoid then return end
                    
                    -- 播放揮動動畫
                    local animationTrack = humanoid:LoadAnimation(swingAnimation)
                    animationTrack:Play()
                    
                    -- 等待動畫播放
                    wait(0.3)
                    
                    -- 檢測前方的敵人
                    local rayOrigin = character:FindFirstChild("HumanoidRootPart").Position
                    local rayDirection = character:FindFirstChild("HumanoidRootPart").CFrame.LookVector * 25
                    local raycastParams = RaycastParams.new()
                    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
                    raycastParams.FilterDescendantsInstances = {character}
                    
                    local raycastResult = workspace:Raycast(rayOrigin, rayDirection, raycastParams)
                    
                    if raycastResult then
                        local hit = raycastResult.Instance
                        local model = hit:FindFirstAncestorOfClass("Model")
                        
                        if model then
                            local targetHumanoid = model:FindFirstChildOfClass("Humanoid")
                            local targetPlayer = game.Players:GetPlayerFromCharacter(model)
                            
                            if targetHumanoid and targetPlayer and targetPlayer ~= player then
                                -- 使用多種方法確保敵人死亡
                                pcall(function()
                                    -- 方法1: 直接設置生命值為0
                                    targetHumanoid.Health = 0
                                    
                                    -- 方法2: 使用TakeDamage方法
                                    targetHumanoid:TakeDamage(math.huge)
                                    
                                    -- 方法3: 使用BreakJoints摧毀關節
                                    model:BreakJoints()
                                    
                                    -- 方法4: 摧毀角色
                                    model:Destroy()
                                    
                                    -- 顯示擊殺效果
                                    WindUI:Notify({
                                        Title = "無限武器擊殺",
                                        Content = "已擊殺: " .. targetPlayer.Name,
                                        Icon = "zap",
                                        Duration = 3
                                    })
                                    
                                    -- 在擊殺位置創建爆炸效果
                                    local explosion = Instance.new("Explosion")
                                    explosion.Position = raycastResult.Position
                                    explosion.BlastPressure = 0
                                    explosion.BlastRadius = 5
                                    explosion.DestroyJointRadiusPercent = 0
                                    explosion.Parent = workspace
                                end)
                            end
                        end
                    end
                end)
                
                -- 武器裝備時的效果
                weapon.Equipped:Connect(function()
                    WindUI:Notify({
                        Title = "無限武器已裝備",
                        Content = "點擊使用無限傷害攻擊",
                        Icon = "zap",
                        Duration = 3
                    })
                end)
                
                -- 將武器添加到玩家背包
                weapon.Parent = player.Backpack
                
                WindUI:Notify({
                    Title = "無限傷害武器已添加",
                    Content = "請查看背包中的LOL無限武器",
                    Icon = "zap",
                    Duration = 3
                })
            end)()
        end
    })

    -- 添加真正有效的防甩飞功能
    local antiFlingEnabled = false
    local antiFlingConnection = nil
    
    MiscTab:Button({
        Title = "防甩飞",
        Icon = "shield",
        Callback = function()
            antiFlingEnabled = not antiFlingEnabled
            
            if antiFlingEnabled then
                WindUI:Notify({
                    Title = "防甩飞已启用",
                    Content = "现在免疫甩飞攻击",
                    Icon = "shield",
                    Duration = 3
                })
                
                local player = game.Players.LocalPlayer
                local character = player.Character
                
                -- 方法1: 移除网络所有权，让服务器控制物理
                if character then
                    local rootPart = character:FindFirstChild("HumanoidRootPart")
                    if rootPart then
                        rootPart:SetNetworkOwner(nil)
                    end
                end
                
                -- 方法2: 创建防甩飞主体
                antiFlingConnection = game:GetService("RunService").Heartbeat:Connect(function()
                    if not antiFlingEnabled then return end
                    
                    local currentCharacter = player.Character
                    if not currentCharacter then return end
                    
                    local humanoid = currentCharacter:FindFirstChild("Humanoid")
                    local rootPart = currentCharacter:FindFirstChild("HumanoidRootPart")
                    
                    if humanoid and rootPart then
                        -- 检测异常运动
                        local velocity = rootPart.Velocity
                        local rotVelocity = rootPart.RotVelocity
                        
                        -- 如果速度异常，立即重置
                        if velocity.Magnitude > 100 or rotVelocity.Magnitude > 50 then
                            -- 立即停止所有运动
                            rootPart.Velocity = Vector3.new(0, 0, 0)
                            rootPart.RotVelocity = Vector3.new(0, 0, 0)
                            
                            -- 短暂锚定来稳定角色
                            rootPart.Anchored = true
                            wait(0.05)
                            rootPart.Anchored = false
                            
                            -- 重置网络所有权
                            rootPart:SetNetworkOwner(nil)
                        end
                        
                        -- 防止角色被旋转
                        if math.abs(rotVelocity.X) > 10 or math.abs(rotVelocity.Y) > 10 or math.abs(rotVelocity.Z) > 10 then
                            rootPart.RotVelocity = Vector3.new(0, 0, 0)
                        end
                        
                        -- 防止角色被甩到异常位置
                        if rootPart.Position.Y < -500 or rootPart.Position.Y > 1000 then
                            -- 传送到安全位置
                            rootPart.CFrame = CFrame.new(0, 50, 0)
                        end
                    end
                end)
                
                -- 方法3: 监听角色变化
                player.CharacterAdded:Connect(function(newChar)
                    character = newChar
                    wait(1) -- 等待角色加载完成
                    
                    -- 为新角色应用防甩飞
                    local newRoot = newChar:FindFirstChild("HumanoidRootPart")
                    if newRoot then
                        newRoot:SetNetworkOwner(nil)
                    end
                end)
                
            else
                -- 禁用防甩飞
                if antiFlingConnection then
                    antiFlingConnection:Disconnect()
                    antiFlingConnection = nil
                end
                
                WindUI:Notify({
                    Title = "防甩飞已禁用",
                    Content = "现在不再免疫甩飞攻击",
                    Icon = "shield-off",
                    Duration = 3
                })
            end
        end
    })

    MiscTab:Divider()

    -- 重置按鈕
    MiscTab:Button({
        Title = "重置所有設置",
        Icon = "refresh-cw",
        Variant = "Secondary",
        Callback = function()
            -- 重置速度
            speedSlider:Set(16)
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = 16
            end
            
            -- 重置跳躍高度
            jumpSlider:Set(50)
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.JumpPower = 50
            end
            
            -- 重置殺戮光環範圍
            killAuraSlider:Set(20)
            killAuraRange = 20
            
            -- 重置自動攻擊範圍
            autoAttackSlider:Set(15)
            autoAttackRange = 15
            
            -- 禁用防甩飞
            if antiFlingEnabled then
                antiFlingEnabled = false
                if antiFlingConnection then
                    antiFlingConnection:Disconnect()
                    antiFlingConnection = nil
                end
            end
            
            -- 禁用穿墙
            if noclipEnabled then
                noclipEnabled = false
                if noclipConnection then
                    noclipConnection:Disconnect()
                    noclipConnection = nil
                end
                
                -- 恢复角色碰撞
                local character = game.Players.LocalPlayer.Character
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") and not part.CanCollide then
                            part.CanCollide = true
                        end
                    end
                end
            end
            
            WindUI:Notify({
                Title = "重置完成",
                Content = "所有設置已重置為默認值",
                Icon = "check",
                Duration = 3
            })
        end
    })

    Window:OnClose(function()
        print("Window closed")
    end)

    Window:OnDestroy(function()
        print("Window destroyed")
    end)
end)()
